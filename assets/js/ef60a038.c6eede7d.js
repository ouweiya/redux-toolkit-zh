"use strict";(self.webpackChunkredux_toolkit_zh=self.webpackChunkredux_toolkit_zh||[]).push([[5618],{1725:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>t,metadata:()=>l,toc:()=>i});var a=n(4848),s=n(8453);const t={title:"\u6d4b\u8bd5",hide_title:!0},c="\u6d4b\u8bd5 Sagas",l={id:"redux-saga/advanced/Testing",title:"\u6d4b\u8bd5",description:"\u6d4b\u8bd5 Sagas \u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a\u9010\u6b65\u6d4b\u8bd5 saga \u751f\u6210\u5668\u51fd\u6570\u6216\u8fd0\u884c\u5b8c\u6574\u7684 saga \u5e76\u65ad\u8a00\u526f\u4f5c\u7528\u3002",source:"@site/docs/redux-saga/advanced/Testing.md",sourceDirName:"redux-saga/advanced",slug:"/redux-saga/advanced/Testing",permalink:"/redux-toolkit-zh/redux-saga/advanced/Testing",draft:!1,unlisted:!1,editUrl:"https://github.com/ouweiya/redux-toolkit-zh/tree/master/docs/redux-saga/advanced/Testing.md",tags:[],version:"current",frontMatter:{title:"\u6d4b\u8bd5",hide_title:!0},sidebar:"reduxSaga",previous:{title:"\u4efb\u52a1\u53d6\u6d88",permalink:"/redux-toolkit-zh/redux-saga/advanced/TaskCancellation"},next:{title:"\u4f7f\u7528 Run Saga",permalink:"/redux-toolkit-zh/redux-saga/advanced/UsingRunSaga"}},d={},i=[{value:"\u6d4b\u8bd5 Saga \u751f\u6210\u5668\u51fd\u6570",id:"\u6d4b\u8bd5-saga-\u751f\u6210\u5668\u51fd\u6570",level:2},{value:"\u5206\u652f Saga",id:"\u5206\u652f-saga",level:3},{value:"\u6d4b\u8bd5\u5b8c\u6574\u7684 Saga",id:"\u6d4b\u8bd5\u5b8c\u6574\u7684-saga",level:2},{value:"\u6d4b\u8bd5\u5e93",id:"\u6d4b\u8bd5\u5e93",level:2},{value:"<code>redux-saga-test</code> \u548c <code>redux-saga-testing</code> \u7528\u4e8e\u9010\u6b65\u6d4b\u8bd5",id:"redux-saga-test-\u548c-redux-saga-testing-\u7528\u4e8e\u9010\u6b65\u6d4b\u8bd5",level:3},{value:"<code>redux-saga-test-plan</code>",id:"redux-saga-test-plan",level:3},{value:"redux-saga-test-engine",id:"redux-saga-test-engine",level:3},{value:"redux-saga-tester",id:"redux-saga-tester",level:3},{value:"<code>effectMiddlewares</code>",id:"effectmiddlewares",level:2}];function o(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.h1,{id:"\u6d4b\u8bd5-sagas",children:"\u6d4b\u8bd5 Sagas"}),"\n",(0,a.jsx)(r.p,{children:"\u6d4b\u8bd5 Sagas \u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a\u9010\u6b65\u6d4b\u8bd5 saga \u751f\u6210\u5668\u51fd\u6570\u6216\u8fd0\u884c\u5b8c\u6574\u7684 saga \u5e76\u65ad\u8a00\u526f\u4f5c\u7528\u3002"}),"\n",(0,a.jsx)(r.h2,{id:"\u6d4b\u8bd5-saga-\u751f\u6210\u5668\u51fd\u6570",children:"\u6d4b\u8bd5 Saga \u751f\u6210\u5668\u51fd\u6570"}),"\n",(0,a.jsx)(r.p,{children:"\u5047\u8bbe\u6211\u4eec\u6709\u4ee5\u4e0b\u64cd\u4f5c\uff1a"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"const CHOOSE_COLOR = 'CHOOSE_COLOR'\r\nconst CHANGE_UI = 'CHANGE_UI'\r\n\r\nconst chooseColor = color => ({\r\n  type: CHOOSE_COLOR,\r\n  payload: {\r\n    color,\r\n  },\r\n})\r\n\r\nconst changeUI = color => ({\r\n  type: CHANGE_UI,\r\n  payload: {\r\n    color,\r\n  },\r\n})\n"})}),"\n",(0,a.jsx)(r.p,{children:"\u6211\u4eec\u60f3\u8981\u6d4b\u8bd5\u8fd9\u4e2a saga\uff1a"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"function* changeColorSaga() {\r\n  const action = yield take(CHOOSE_COLOR)\r\n  yield put(changeUI(action.payload.color))\r\n}\n"})}),"\n",(0,a.jsxs)(r.p,{children:["\u7531\u4e8e Sagas \u603b\u662f\u4ea7\u751f\u4e00\u4e2a Effect\uff0c\u8fd9\u4e9b effects \u6709\u57fa\u672c\u7684\u5de5\u5382\u51fd\u6570\uff08\u4f8b\u5982 put\uff0ctake \u7b49\uff09\uff0c\u6d4b\u8bd5\u53ef\u4ee5\u68c0\u67e5\u4ea7\u751f\u7684 effect \u5e76\u5c06\u5176\u4e0e\u9884\u671f\u7684 effect \u8fdb\u884c\u6bd4\u8f83\u3002\u8981\u4ece saga \u83b7\u53d6\u7b2c\u4e00\u4e2a\u4ea7\u751f\u7684\u503c\uff0c\u8c03\u7528\u5176 ",(0,a.jsx)(r.code,{children:"next().value"}),"\uff1a"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"const gen = changeColorSaga()\r\n\r\nassert.deepEqual(gen.next().value, take(CHOOSE_COLOR), '\u5b83\u5e94\u8be5\u7b49\u5f85\u7528\u6237\u9009\u62e9\u989c\u8272')\n"})}),"\n",(0,a.jsxs)(r.p,{children:["\u7136\u540e\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u503c\u4ee5\u8d4b\u503c\u7ed9 ",(0,a.jsx)(r.code,{children:"action"})," \u5e38\u91cf\uff0c\u8be5\u5e38\u91cf\u7528\u4f5c ",(0,a.jsx)(r.code,{children:"put"})," effect \u7684\u53c2\u6570\uff1a"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"const color = 'red'\r\nassert.deepEqual(\r\n  gen.next(chooseColor(color)).value,\r\n  put(changeUI(color)),\r\n  '\u5b83\u5e94\u8be5\u6d3e\u53d1\u4e00\u4e2a\u64cd\u4f5c\u6765\u6539\u53d8 UI',\r\n)\n"})}),"\n",(0,a.jsxs)(r.p,{children:["\u7531\u4e8e\u6ca1\u6709\u66f4\u591a\u7684 ",(0,a.jsx)(r.code,{children:"yield"}),"\uff0c\u6240\u4ee5\u4e0b\u6b21\u8c03\u7528 ",(0,a.jsx)(r.code,{children:"next()"})," \u65f6\uff0c\u751f\u6210\u5668\u5c06\u5b8c\u6210\uff1a"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"assert.deepEqual(gen.next().done, true, '\u5b83\u5e94\u8be5\u5b8c\u6210')\n"})}),"\n",(0,a.jsx)(r.h3,{id:"\u5206\u652f-saga",children:"\u5206\u652f Saga"}),"\n",(0,a.jsxs)(r.p,{children:["\u6709\u65f6\u4f60\u7684 saga \u4f1a\u6709\u4e0d\u540c\u7684\u7ed3\u679c\u3002\u4e3a\u4e86\u6d4b\u8bd5\u4e0d\u540c\u7684\u5206\u652f\u800c\u4e0d\u91cd\u590d\u6240\u6709\u5bfc\u81f4\u5b83\u7684\u6b65\u9aa4\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u5b9e\u7528\u51fd\u6570 ",(0,a.jsx)(r.strong,{children:"cloneableGenerator"})]}),"\n",(0,a.jsxs)(r.p,{children:["\u8fd9\u6b21\u6211\u4eec\u6dfb\u52a0\u4e24\u4e2a\u65b0\u7684\u64cd\u4f5c\uff0c",(0,a.jsx)(r.code,{children:"CHOOSE_NUMBER"})," \u548c ",(0,a.jsx)(r.code,{children:"DO_STUFF"}),"\uff0c\u4ee5\u53ca\u76f8\u5173\u7684\u64cd\u4f5c\u521b\u5efa\u5668\uff1a"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"const CHOOSE_NUMBER = 'CHOOSE_NUMBER'\r\nconst DO_STUFF = 'DO_STUFF'\r\n\r\nconst chooseNumber = number => ({\r\n  type: CHOOSE_NUMBER,\r\n  payload: {\r\n    number,\r\n  },\r\n})\r\n\r\nconst doStuff = () => ({\r\n  type: DO_STUFF,\r\n})\n"})}),"\n",(0,a.jsxs)(r.p,{children:["\u73b0\u5728\u8981\u6d4b\u8bd5\u7684 saga \u5c06\u5728\u7b49\u5f85 ",(0,a.jsx)(r.code,{children:"CHOOSE_NUMBER"})," \u64cd\u4f5c\u5e76\u653e\u7f6e ",(0,a.jsx)(r.code,{children:"changeUI('red')"})," \u6216 ",(0,a.jsx)(r.code,{children:"changeUI('blue')"})," \u4e4b\u524d\uff0c\u653e\u7f6e\u4e24\u4e2a ",(0,a.jsx)(r.code,{children:"DO_STUFF"})," \u64cd\u4f5c\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u6570\u5b57\u662f\u5076\u6570\u8fd8\u662f\u5947\u6570\u3002"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"function* doStuffThenChangeColor() {\r\n  yield put(doStuff())\r\n  yield put(doStuff())\r\n  const action = yield take(CHOOSE_NUMBER)\r\n  if (action.payload.number % 2 === 0) {\r\n    yield put(changeUI('red'))\r\n  } else {\r\n    yield put(changeUI('blue'))\r\n  }\r\n}\n"})}),"\n",(0,a.jsx)(r.p,{children:"\u6d4b\u8bd5\u5982\u4e0b\uff1a"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"import { put, take } from 'redux-saga/effects'\r\nimport { cloneableGenerator } from '@redux-saga/testing-utils'\r\n\r\ntest('doStuffThenChangeColor', assert => {\r\n  const gen = cloneableGenerator(doStuffThenChangeColor)()\r\n  gen.next() // DO_STUFF\r\n  gen.next() // DO_STUFF\r\n  gen.next() // CHOOSE_NUMBER\r\n\r\n  assert.test('\u7528\u6237\u9009\u62e9\u4e86\u4e00\u4e2a\u5076\u6570', a => {\r\n    // \u5728\u53d1\u9001\u6570\u636e\u4e4b\u524d\u514b\u9686\u751f\u6210\u5668\r\n    const clone = gen.clone()\r\n    a.deepEqual(clone.next(chooseNumber(2)).value, put(changeUI('red')), '\u5e94\u8be5\u5c06\u989c\u8272\u6539\u4e3a\u7ea2\u8272')\r\n\r\n    a.equal(clone.next().done, true, '\u5b83\u5e94\u8be5\u5b8c\u6210')\r\n\r\n    a.end()\r\n  })\r\n\r\n  assert.test('\u7528\u6237\u9009\u62e9\u4e86\u4e00\u4e2a\u5947\u6570', a => {\r\n    const clone = gen.clone()\r\n    a.deepEqual(clone.next(chooseNumber(3)).value, put(changeUI('blue')), '\u5e94\u8be5\u5c06\u989c\u8272\u6539\u4e3a\u84dd\u8272')\r\n\r\n    a.equal(clone.next().done, true, '\u5b83\u5e94\u8be5\u5b8c\u6210')\r\n\r\n    a.end()\r\n  })\r\n})\n"})}),"\n",(0,a.jsxs)(r.p,{children:["\u53e6\u8bf7\u53c2\u89c1\uff1a",(0,a.jsx)(r.a,{href:"/redux-toolkit-zh/redux-saga/advanced/TaskCancellation",children:"\u4efb\u52a1\u53d6\u6d88"})," \u7528\u4e8e\u6d4b\u8bd5 fork effects"]}),"\n",(0,a.jsx)(r.h2,{id:"\u6d4b\u8bd5\u5b8c\u6574\u7684-saga",children:"\u6d4b\u8bd5\u5b8c\u6574\u7684 Saga"}),"\n",(0,a.jsx)(r.p,{children:"\u5c3d\u7ba1\u6d4b\u8bd5 saga \u7684\u6bcf\u4e00\u6b65\u53ef\u80fd\u5f88\u6709\u7528\uff0c\u4f46\u5b9e\u9645\u4e0a\u8fd9\u4f1a\u4f7f\u6d4b\u8bd5\u53d8\u5f97\u8106\u5f31\u3002\u76f8\u53cd\uff0c\u53ef\u80fd\u66f4\u5e0c\u671b\u8fd0\u884c\u6574\u4e2a saga \u5e76\u65ad\u8a00\u5df2\u53d1\u751f\u7684\u9884\u671f\u6548\u679c\u3002"}),"\n",(0,a.jsx)(r.p,{children:"\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u57fa\u672c\u7684 saga\uff0c\u5b83\u8c03\u7528\u4e00\u4e2a HTTP API\uff1a"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"function* callApi(url) {\r\n  const someValue = yield select(somethingFromState)\r\n  try {\r\n    const result = yield call(myApi, url, someValue)\r\n    yield put(success(result.json()))\r\n    return result.status\r\n  } catch (e) {\r\n    yield put(error(e))\r\n    return -1\r\n  }\r\n}\n"})}),"\n",(0,a.jsx)(r.p,{children:"\u6211\u4eec\u53ef\u4ee5\u7528\u6a21\u62df\u503c\u8fd0\u884c saga\uff1a"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"const dispatched = []\r\n\r\nconst saga = runSaga(\r\n  {\r\n    dispatch: action => dispatched.push(action),\r\n    getState: () => ({ value: 'test' }),\r\n  },\r\n  callApi,\r\n  'http://url',\r\n)\n"})}),"\n",(0,a.jsx)(r.p,{children:"\u7136\u540e\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2a\u6d4b\u8bd5\u6765\u65ad\u8a00\u6d3e\u53d1\u7684\u64cd\u4f5c\u548c\u6a21\u62df\u8c03\u7528\uff1a"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"import sinon from 'sinon'\r\nimport * as api from './api'\r\n\r\ntest('callApi', async assert => {\r\n  const dispatched = []\r\n  sinon.stub(api, 'myApi').callsFake(() => ({\r\n    json: () => ({\r\n      some: 'value',\r\n    }),\r\n  }))\r\n  const url = 'http://url'\r\n  const result = await runSaga(\r\n    {\r\n      dispatch: action => dispatched.push(action),\r\n      getState: () => ({ state: 'test' }),\r\n    },\r\n    callApi,\r\n    url,\r\n  ).toPromise()\r\n\r\n  assert.true(myApi.calledWith(url, somethingFromState({ state: 'test' })))\r\n  assert.deepEqual(dispatched, [success({ some: 'value' })])\r\n})\n"})}),"\n",(0,a.jsx)(r.p,{children:"\u53e6\u8bf7\u53c2\u89c1\uff1a\u4ed3\u5e93\u793a\u4f8b\uff1a"}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.a,{href:"https://github.com/redux-saga/redux-saga/blob/main/examples/counter/test/sagas.js",children:"https://github.com/redux-saga/redux-saga/blob/main/examples/counter/test/sagas.js"})}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.a,{href:"https://github.com/redux-saga/redux-saga/blob/main/examples/shopping-cart/test/sagas.js",children:"https://github.com/redux-saga/redux-saga/blob/main/examples/shopping-cart/test/sagas.js"})}),"\n",(0,a.jsx)(r.h2,{id:"\u6d4b\u8bd5\u5e93",children:"\u6d4b\u8bd5\u5e93"}),"\n",(0,a.jsx)(r.p,{children:"\u867d\u7136\u4e0a\u8ff0\u4e24\u79cd\u6d4b\u8bd5\u65b9\u6cd5\u90fd\u53ef\u4ee5\u539f\u751f\u7f16\u5199\uff0c\u4f46\u5b58\u5728\u51e0\u4e2a\u5e93\u53ef\u4ee5\u4f7f\u4e24\u79cd\u65b9\u6cd5\u66f4\u5bb9\u6613\u3002\u6b64\u5916\uff0c\u6709\u4e9b\u5e93\u53ef\u4ee5\u7528\u7b2c\u4e09\u79cd\u65b9\u5f0f\u6d4b\u8bd5 sagas\uff1a\u8bb0\u5f55\u7279\u5b9a\u7684\u526f\u4f5c\u7528\uff08\u4f46\u4e0d\u662f\u5168\u90e8\uff09\u3002"}),"\n",(0,a.jsxs)(r.p,{children:["Sam Hogarth\u7684 (@sh1989) ",(0,a.jsx)(r.a,{href:"http://blog.scottlogic.com/2018/01/16/evaluating-redux-saga-test-libraries.html",children:"\u6587\u7ae0"})," \u5f88\u597d\u5730\u603b\u7ed3\u4e86\u4e0d\u540c\u7684\u9009\u9879\u3002"]}),"\n",(0,a.jsxs)(r.p,{children:["\u5bf9\u4e8e\u9010\u6b65\u6d4b\u8bd5\u6bcf\u4e2a\u751f\u6210\u5668\u7684\u4ea7\u51fa\uff0c\u6709 ",(0,a.jsx)(r.a,{href:"https://github.com/stoeffel/redux-saga-test",children:(0,a.jsx)(r.code,{children:"redux-saga-test"})})," \u548c ",(0,a.jsx)(r.a,{href:"https://github.com/antoinejaussoin/redux-saga-testing/",children:(0,a.jsx)(r.code,{children:"redux-saga-testing"})}),"\u3002",(0,a.jsx)(r.a,{href:"https://github.com/DNAinfo/redux-saga-test-engine",children:(0,a.jsx)(r.code,{children:"redux-saga-test-engine"})})," \u7528\u4e8e\u8bb0\u5f55\u548c\u6d4b\u8bd5\u7279\u5b9a\u7684\u526f\u4f5c\u7528\u3002\u5bf9\u4e8e\u96c6\u6210\u6d4b\u8bd5\uff0c\u6709 ",(0,a.jsx)(r.a,{href:"https://github.com/wix/redux-saga-tester",children:(0,a.jsx)(r.code,{children:"redux-saga-tester"})}),"\u3002\u800c ",(0,a.jsx)(r.a,{href:"https://github.com/jfairbank/redux-saga-test-plan",children:(0,a.jsx)(r.code,{children:"redux-saga-test-plan"})})," \u5b9e\u9645\u4e0a\u53ef\u4ee5\u8986\u76d6\u6240\u6709\u4e09\u4e2a\u57fa\u7840\u3002"]}),"\n",(0,a.jsxs)(r.h3,{id:"redux-saga-test-\u548c-redux-saga-testing-\u7528\u4e8e\u9010\u6b65\u6d4b\u8bd5",children:[(0,a.jsx)(r.code,{children:"redux-saga-test"})," \u548c ",(0,a.jsx)(r.code,{children:"redux-saga-testing"})," \u7528\u4e8e\u9010\u6b65\u6d4b\u8bd5"]}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.code,{children:"redux-saga-test"})," \u5e93\u4e3a\u4f60\u7684\u9010\u6b65\u6d4b\u8bd5\u63d0\u4f9b\u4e86\u8bed\u6cd5\u7cd6\u3002",(0,a.jsx)(r.code,{children:"fromGenerator"})," \u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u53ef\u4ee5\u7528 ",(0,a.jsx)(r.code,{children:".next()"})," \u624b\u52a8\u8fed\u4ee3\u5e76\u4f7f\u7528\u76f8\u5173\u7684 saga \u6548\u679c\u65b9\u6cd5\u8fdb\u884c\u65ad\u8a00\u7684\u503c\u3002"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"import fromGenerator from 'redux-saga-test'\r\n\r\ntest('with redux-saga-test', () => {\r\n  const generator = callApi('url')\r\n  /*\r\n   * \u4f20\u9012\u7ed9 fromGenerator \u7684\u65ad\u8a00\r\n   * \u9700\u8981\u4e00\u4e2a `deepEqual` \u65b9\u6cd5\r\n   */\r\n  const expect = fromGenerator(assertions, generator)\r\n\r\n  expect.next().select(somethingFromState)\r\n  expect.next(selectedData).call(myApi, 'url', selectedData)\r\n  expect.next(result).put(success(result.json))\r\n})\n"})}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.code,{children:"redux-saga-testing"})," \u5e93\u63d0\u4f9b\u4e86\u4e00\u4e2a ",(0,a.jsx)(r.code,{children:"sagaHelper"})," \u65b9\u6cd5\uff0c\u5b83\u63a5\u53d7\u4f60\u7684\u751f\u6210\u5668\u5e76\u8fd4\u56de\u4e00\u4e2a\u503c\uff0c\u8fd9\u4e2a\u503c\u7684\u5de5\u4f5c\u65b9\u5f0f\u5f88\u50cf Jest \u7684 ",(0,a.jsx)(r.code,{children:"it()"})," \u51fd\u6570\uff0c\u4f46\u4e5f\u63a8\u8fdb\u4e86\u88ab\u6d4b\u8bd5\u7684\u751f\u6210\u5668\u3002\u4f20\u5165\u56de\u8c03\u7684 ",(0,a.jsx)(r.code,{children:"result"})," \u53c2\u6570\u662f\u751f\u6210\u5668\u4ea7\u51fa\u7684\u503c\u3002"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"import sagaHelper from 'redux-saga-testing'\r\n\r\ntest('with redux-saga-testing', () => {\r\n  const it = sagaHelper(callApi())\r\n\r\n  it('should select from state', selectResult => {\r\n    // \u4f7f\u7528 Jest \u7684 `expect`\r\n    expect(selectResult).toBe(value)\r\n  })\r\n\r\n  it('should select from state', apiResponse => {\r\n    // \u4e0d\u4f7f\u7528 tape \u7684 `test`\r\n    assert.deepEqual(apiResponse.json(), jsonResponse)\r\n  })\r\n\r\n  // \u7a7a\u7684 `it` \u8c03\u7528\u53ef\u4ee5\u7528\u6765\u8df3\u8fc7\u4e00\u4e2a\u6548\u679c\r\n  it('', () => {})\r\n})\n"})}),"\n",(0,a.jsx)(r.h3,{id:"redux-saga-test-plan",children:(0,a.jsx)(r.code,{children:"redux-saga-test-plan"})}),"\n",(0,a.jsxs)(r.p,{children:["\u8fd9\u662f\u6700\u901a\u7528\u7684\u5e93\u3002",(0,a.jsx)(r.code,{children:"testSaga"})," API \u7528\u4e8e\u7cbe\u786e\u987a\u5e8f\u6d4b\u8bd5\uff0c",(0,a.jsx)(r.code,{children:"expectSaga"})," \u7528\u4e8e\u8bb0\u5f55\u526f\u4f5c\u7528\u548c\u96c6\u6210\u6d4b\u8bd5\u3002"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"import { expectSaga, testSaga } from 'redux-saga-test-plan';\r\n\r\ntest('exact order with redux-saga-test-plan', () => {\r\n  return testSaga(callApi, 'url')\r\n    .next()\r\n    .select(selectFromState)\r\n    .next()\r\n    .call(myApi, 'url', valueFromSelect);\r\n\r\n    ...\r\n});\r\n\r\ntest('recorded effects with redux-saga-test-plan', () => {\r\n  /*\r\n  * \u4f7f\u7528 expectSaga\uff0c\u4f60\u53ef\u4ee5\u65ad\u8a00\u4f60\u7684 saga \u4e2d\u7684\u4efb\u4f55\u4ea7\u51fa\r\n  * \u90fd\u5982\u9884\u671f\u90a3\u6837\u53d1\u751f\uff0c*\u65e0\u8bba\u987a\u5e8f\u5982\u4f55*\u3002\r\n  * \u4f60\u5fc5\u987b\u5728\u6700\u540e\u8c03\u7528 .run()\u3002\r\n  */\r\n  return expectSaga(callApi, 'url')\r\n    .put(success(value)) // \u6211\u4eec\u7684 saga \u7684\u6700\u540e\u4e00\u4e2a\u6548\u679c\uff0c\u7b2c\u4e00\u4e2a\u88ab\u6d4b\u8bd5\u7684\r\n\r\n    .call(myApi, 'url', value)\r\n    .run();\r\n    /* \u6ce8\u610f\u6ca1\u6709\u5bf9 select \u8c03\u7528\u7684\u65ad\u8a00 */\r\n});\r\n\r\ntest('test only final effect with .provide()', () => {\r\n  /*\r\n  * \u4f7f\u7528 expectSaga \u7684 .provide() \u65b9\u6cd5\r\n  * \u4f60\u53ef\u4ee5\u4f20\u5165\u6240\u6709\u9884\u671f\u7684\u503c\r\n  * \u5e76\u53ea\u6d4b\u8bd5\u4f60\u7684 saga \u7684\u6700\u7ec8\u6548\u679c\u3002\r\n  */\r\n  return expectSaga(callApi, 'url')\r\n    .provide([\r\n      [select(selectFromState), selectedValue],\r\n      [call(myApi, 'url', selectedValue), response]\r\n    ])\r\n    .put(success(response))\r\n    .run();\r\n});\r\n\r\ntest('integration test with withReducer', () => {\r\n  /*\r\n  * \u4f7f\u7528 `withReducer` \u53ef\u4ee5\u8ba9\u4f60\u6d4b\u8bd5\r\n  * \u5728\u4f60\u7684 reducer \u5b8c\u6210\u540e\u7684\u72b6\u6001\u5f62\u72b6 -\r\n  * \u5bf9\u4f60\u7684 Redux \u5b58\u50a8\u7ba1\u7406\u7684\u771f\u6b63\u96c6\u6210\u6d4b\u8bd5\u3002\r\n  */\r\n\r\n  return expectSaga(callApi, 'url')\r\n    .withReducer(myReducer)\r\n    .provide([\r\n      [call(myApi, 'url', value), response]\r\n    ])\r\n    .hasFinalState({\r\n      data: response\r\n    })\r\n    .run();\r\n});\n"})}),"\n",(0,a.jsx)(r.h3,{id:"redux-saga-test-engine",children:"redux-saga-test-engine"}),"\n",(0,a.jsxs)(r.p,{children:["\u8fd9\u4e2a\u5e93\u7684\u8bbe\u7f6e\u65b9\u5f0f\u4e0e",(0,a.jsx)(r.code,{children:"redux-saga-test-plan"}),"\u975e\u5e38\u76f8\u4f3c\uff0c\u4f46\u6700\u597d\u7528\u6765\u8bb0\u5f55\u6548\u679c\u3002\u63d0\u4f9b\u4e00\u7ec4\u7531",(0,a.jsx)(r.code,{children:"createSagaTestEngine"}),"\u51fd\u6570\u89c2\u5bdf\u7684saga\u901a\u7528\u6548\u679c\u96c6\u5408\uff0c\u8be5\u51fd\u6570\u53cd\u8fc7\u6765\u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\u3002\u7136\u540e\u63d0\u4f9b\u4f60\u7684saga\u548c\u7279\u5b9a\u7684\u6548\u679c\u53ca\u5176\u53c2\u6570\u3002"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"const collectedEffects  = createSagaTestEngine(['SELECT', 'CALL', 'PUT']);\r\nconst actualEffects = collectEffects(mySaga, [ [myEffect(arg), value], ... ], argsToMySaga);\n"})}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.code,{children:"actualEffects"}),"\u7684\u503c\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u5305\u542b\u6240\u6709_\u6536\u96c6\u5230\u7684_\u6548\u679c\u4ea7\u751f\u7684\u503c\uff0c\u6309\u7167\u51fa\u73b0\u7684\u987a\u5e8f\u3002"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"import createSagaTestEngine from 'redux-saga-test-engine'\r\n\r\ntest('\u4f7f\u7528redux-saga-test-engine\u8fdb\u884c\u6d4b\u8bd5', () => {\r\n  const collectEffects = createSagaTestEngine(['CALL', 'PUT'])\r\n\r\n  const actualEffects = collectEffects(\r\n    callApi,\r\n    [[select(selectFromState), selectedValue], [call(myApi, 'url', selectedValue), response]],\r\n    // \u4efb\u4f55\u8fdb\u4e00\u6b65\u7684\u53c2\u6570\u90fd\u4f20\u9012\u7ed9saga\r\n    // \u8fd9\u91cc\u662f\u6211\u4eec\u7684URL\uff0c\u4f46\u901a\u5e38\u4f1a\u662f\u6d3e\u53d1\u7684\u52a8\u4f5c\r\n    'url',\r\n  )\r\n\r\n  // \u65ad\u8a00\u4f60\u5173\u5fc3\u7684\u6548\u679c\u6309\u9884\u671f\u53d1\u751f\uff0c\u6309\u987a\u5e8f\r\n  assert.equal(actualEffects[0], call(myApi, 'url', selectedValue))\r\n  assert.equal(actualEffects[1], put(success, response))\r\n\r\n  // \u65ad\u8a00\u4f60\u7684saga\u6ca1\u6709\u505a\u4efb\u4f55\u610f\u5916\u7684\u4e8b\u60c5\r\n  assert.true(actualEffects.length === 2)\r\n})\n"})}),"\n",(0,a.jsx)(r.h3,{id:"redux-saga-tester",children:"redux-saga-tester"}),"\n",(0,a.jsxs)(r.p,{children:["\u6700\u540e\u4e00\u4e2a\u8003\u8651\u8fdb\u884c\u96c6\u6210\u6d4b\u8bd5\u7684\u5e93\u3002\u8fd9\u4e2a\u5e93\u63d0\u4f9b\u4e86\u4e00\u4e2a",(0,a.jsx)(r.code,{children:"sagaTester"}),"\u7c7b\uff0c\u4f60\u53ef\u4ee5\u7528\u4f60\u7684\u5b58\u50a8\u7684\u521d\u59cb\u72b6\u6001\u548c\u4f60\u7684reducer\u6765\u5b9e\u4f8b\u5316\u5b83\u3002"]}),"\n",(0,a.jsxs)(r.p,{children:["\u8981\u6d4b\u8bd5\u4f60\u7684saga\uff0c\u4f7f\u7528",(0,a.jsx)(r.code,{children:"sagaTester"}),"\u5b9e\u4f8b\u7684",(0,a.jsx)(r.code,{children:"start()"}),"\u65b9\u6cd5\u548c\u4f60\u7684saga\u53ca\u5176\u53c2\u6570\u3002\u8fd9\u5c06\u8fd0\u884c\u4f60\u7684saga\u5230\u7ed3\u675f\u3002\u7136\u540e\u4f60\u53ef\u4ee5\u65ad\u8a00\u6548\u679c\u53d1\u751f\uff0c\u52a8\u4f5c\u88ab\u6d3e\u53d1\uff0c\u72b6\u6001\u5982\u9884\u671f\u66f4\u65b0\u3002"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"import SagaTester from 'redux-saga-tester';\r\n\r\ntest('\u4f7f\u7528redux-saga-tester', () => {\r\n  const sagaTester = new SagaTester({\r\n    initialState: defaultState,\r\n    reducers: reducer\r\n  });\r\n\r\n  sagaTester.start(callApi);\r\n\r\n  sagaTester.dispatch(actionToTriggerSaga());\r\n\r\n  await sagaTester.waitFor(success);\r\n\r\n  assert.true(sagaTester.wasCalled(success(response)));\r\n\r\n  assert.deepEqual(sagaTester.getState(), { data: response });\r\n});\n"})}),"\n",(0,a.jsx)(r.h2,{id:"effectmiddlewares",children:(0,a.jsx)(r.code,{children:"effectMiddlewares"})}),"\n",(0,a.jsx)(r.p,{children:"\u63d0\u4f9b\u4e86\u4e00\u79cd\u539f\u751f\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u7c7b\u4f3c\u96c6\u6210\u7684\u6d4b\u8bd5\uff0c\u800c\u4e0d\u9700\u8981\u4e0a\u8ff0\u7684\u5e93\u3002"}),"\n",(0,a.jsxs)(r.p,{children:["\u8fd9\u4e2a\u60f3\u6cd5\u662f\uff0c\u4f60\u53ef\u4ee5\u5728\u4f60\u7684\u6d4b\u8bd5\u6587\u4ef6\u4e2d\u521b\u5efa\u4e00\u4e2a\u5e26\u6709saga\u4e2d\u95f4\u4ef6\u7684\u771f\u5b9eredux\u5b58\u50a8\u3002saga\u4e2d\u95f4\u4ef6\u63a5\u53d7\u4e00\u4e2a\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u3002\u8be5\u5bf9\u8c61\u5c06\u6709\u4e00\u4e2a",(0,a.jsx)(r.code,{children:"effectMiddlewares"}),"\u503c\uff1a\u4e00\u4e2a\u51fd\u6570\uff0c\u4f60\u53ef\u4ee5\u5728\u5176\u4e2d\u62e6\u622a/\u52ab\u6301\u4efb\u4f55\u6548\u679c\u5e76\u81ea\u884c\u89e3\u51b3\u5b83 - \u5c06\u5b83\u975e\u5e38redux\u98ce\u683c\u5730\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u3002"]}),"\n",(0,a.jsx)(r.p,{children:"\u5728\u4f60\u7684\u6d4b\u8bd5\u4e2d\uff0c\u4f60\u5c06\u542f\u52a8\u4e00\u4e2asaga\uff0c\u4f7f\u7528effectMiddlewares\u62e6\u622a/\u89e3\u51b3\u5f02\u6b65\u6548\u679c\uff0c\u5e76\u65ad\u8a00\u8bf8\u5982\u72b6\u6001\u66f4\u65b0\u4e4b\u7c7b\u7684\u4e8b\u60c5\u6765\u6d4b\u8bd5\u4f60\u7684saga\u548c\u5b58\u50a8\u4e4b\u95f4\u7684\u96c6\u6210\u3002"}),"\n",(0,a.jsxs)(r.p,{children:["\u8fd9\u662f",(0,a.jsx)(r.a,{href:"https://github.com/redux-saga/redux-saga/blob/34c9093684323ab92eacdf2df958f31d9873d3b1/test/interpreter/effectMiddlewares.js#L88",children:"\u6587\u6863"}),"\u4e2d\u7684\u4e00\u4e2a\u4f8b\u5b50\uff1a"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-javascript",children:"test('effectMiddleware', assert => {\r\n  assert.plan(1)\r\n\r\n  let actual = []\r\n\r\n  function rootReducer(state = {}, action) {\r\n    return action\r\n  }\r\n\r\n  const effectMiddleware = next => effect => {\r\n    if (effect === apiCall) {\r\n      Promise.resolve().then(() => next('injected value'))\r\n      return\r\n    }\r\n    return next(effect)\r\n  }\r\n\r\n  const middleware = sagaMiddleware({ effectMiddlewares: [effectMiddleware] })\r\n  const store = createStore(rootReducer, {}, applyMiddleware(middleware))\r\n\r\n  const apiCall = call(() => new Promise(() => {}))\r\n\r\n  function* root() {\r\n    actual.push(yield all([call(fnA), apiCall]))\r\n  }\r\n\r\n  function* fnA() {\r\n    const result = []\r\n    result.push((yield take('ACTION-1')).val)\r\n    result.push((yield take('ACTION-2')).val)\r\n    return result\r\n  }\r\n\r\n  const task = middleware.run(root)\r\n\r\n  Promise.resolve()\r\n    .then(() => store.dispatch({ type: 'ACTION-1', val: 1 }))\r\n    .then(() => store.dispatch({ type: 'ACTION-2', val: 2 }))\r\n\r\n  const expected = [[[1, 2], 'injected value']]\r\n\r\n  task\r\n    .toPromise()\r\n    .then(() => {\r\n      assert.deepEqual(\r\n        actual,\r\n        expected,\r\n        'effectMiddleware\u5fc5\u987b\u80fd\u591f\u4ee5\u81ea\u5b9a\u4e49\u7684\u65b9\u5f0f\u62e6\u622a\u548c\u89e3\u51b3\u6548\u679c',\r\n      )\r\n    })\r\n    .catch(err => assert.fail(err))\r\n})\n"})})]})}function u(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>l});var a=n(6540);const s={},t=a.createContext(s);function c(e){const r=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),a.createElement(t.Provider,{value:r},e.children)}}}]);