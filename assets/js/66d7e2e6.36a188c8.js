"use strict";(self.webpackChunkredux_toolkit_zh=self.webpackChunkredux_toolkit_zh||[]).push([[7076],{1285:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var t=n(4848),o=n(8453);const a={id:"error-handling",title:"Error Handling",sidebar_label:"Error Handling",hide_title:!0,description:"RTK Query > Usage > Error Handling: dealing with API errors"},i="Error Handling",s={id:"rtk-query/usage/error-handling",title:"Error Handling",description:"RTK Query > Usage > Error Handling: dealing with API errors",source:"@site/docs/rtk-query/usage/error-handling.mdx",sourceDirName:"rtk-query/usage",slug:"/rtk-query/usage/error-handling",permalink:"/redux-toolkit-zh/rtk-query/usage/error-handling",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/rtk-query/usage/error-handling.mdx",tags:[],version:"current",frontMatter:{id:"error-handling",title:"Error Handling",sidebar_label:"Error Handling",hide_title:!0,description:"RTK Query > Usage > Error Handling: dealing with API errors"},sidebar:"docs",previous:{title:"Conditional Fetching",permalink:"/redux-toolkit-zh/rtk-query/usage/conditional-fetching"},next:{title:"Pagination",permalink:"/redux-toolkit-zh/rtk-query/usage/pagination"}},d={},l=[{value:"Overview",id:"overview",level:2},{value:"Error Display Examples",id:"error-display-examples",level:3},{value:"Errors with a custom <code>baseQuery</code>",id:"errors-with-a-custom-basequery",level:2},{value:"Handling errors at a macro level",id:"handling-errors-at-a-macro-level",level:2}];function c(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.p,{children:"\xa0"}),"\n",(0,t.jsx)(r.h1,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(r.p,{children:["If your query or mutation happens to throw an error when using ",(0,t.jsx)(r.a,{href:"../api/fetchBaseQuery",children:"fetchBaseQuery"}),", it will be returned in the ",(0,t.jsx)(r.code,{children:"error"})," property of the respective hook. The component will re-render when that occurs, and you can show appropriate UI based on the error data if desired."]}),"\n",(0,t.jsx)(r.h3,{id:"error-display-examples",children:"Error Display Examples"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-tsx",metastring:'no-transpile title="Query Error"',children:"function PostsList() {\n  const { data, error } = useGetPostsQuery()\n\n  return (\n    <div>\n      {error.status} {JSON.stringify(error.data)}\n    </div>\n  )\n}\n"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-tsx",metastring:'no-transpile title="Mutation Error"',children:"function AddPost() {\n  const [addPost, { error }] = useAddPostMutation()\n\n  return (\n    <div>\n      {error.status} {JSON.stringify(error.data)}\n    </div>\n  )\n}\n"})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsxs)(r.p,{children:["If you need to access the error or success payload immediately after a mutation, you can chain ",(0,t.jsx)(r.code,{children:".unwrap()"}),"."]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",metastring:'title="Using .unwrap" no-transpile',children:"addPost({ id: 1, name: 'Example' })\n  .unwrap()\n  .then((payload) => console.log('fulfilled', payload))\n  .catch((error) => console.error('rejected', error))\n"})})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-tsx",metastring:'no-transpile title="Manually selecting an error"',children:"function PostsList() {\n  const { error } = useSelector(api.endpoints.getPosts.select())\n\n  return (\n    <div>\n      {error.status} {JSON.stringify(error.data)}\n    </div>\n  )\n}\n"})}),"\n",(0,t.jsxs)(r.h2,{id:"errors-with-a-custom-basequery",children:["Errors with a custom ",(0,t.jsx)(r.code,{children:"baseQuery"})]}),"\n",(0,t.jsxs)(r.p,{children:["Whether a response is returned as ",(0,t.jsx)(r.code,{children:"data"})," or ",(0,t.jsx)(r.code,{children:"error"})," is dictated by the ",(0,t.jsx)(r.code,{children:"baseQuery"})," provided."]}),"\n",(0,t.jsxs)(r.p,{children:["Ultimately, you can choose whatever library you prefer to use with your ",(0,t.jsx)(r.code,{children:"baseQuery"}),", but it's important that you return the correct response format. If you haven't tried ",(0,t.jsx)(r.a,{href:"../api/fetchBaseQuery",children:(0,t.jsx)(r.code,{children:"fetchBaseQuery"})})," yet, give it a chance! Otherwise, see ",(0,t.jsx)(r.a,{href:"./customizing-queries",children:"Customizing Queries"})," for information on how to alter the returned errors."]}),"\n",(0,t.jsx)(r.h2,{id:"handling-errors-at-a-macro-level",children:"Handling errors at a macro level"}),"\n",(0,t.jsx)(r.p,{children:"There are quite a few ways that you can manage your errors, and in some cases, you may want to show a generic toast notification for any async error. Being that RTK Query is built on top of Redux and Redux-Toolkit, you can easily add a middleware to your store for this purpose."}),"\n",(0,t.jsx)(r.admonition,{type:"tip",children:(0,t.jsxs)(r.p,{children:["Redux Toolkit has ",(0,t.jsx)(r.a,{href:"/redux-toolkit-zh/api/matching-utilities#matching-utilities",children:"action matching utilities"})," that we can leverage for additional custom behaviors."]})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",metastring:'no-transpile title="Error catching middleware example"',children:"import { isRejectedWithValue } from '@reduxjs/toolkit'\nimport type { MiddlewareAPI, Middleware } from '@reduxjs/toolkit'\nimport { toast } from 'your-cool-library'\n\n/**\n * Log a warning and show a toast!\n */\nexport const rtkQueryErrorLogger: Middleware =\n  (api: MiddlewareAPI) => (next) => (action) => {\n    // RTK Query uses `createAsyncThunk` from redux-toolkit under the hood, so we're able to utilize these matchers!\n    if (isRejectedWithValue(action)) {\n      console.warn('We got a rejected action!')\n      toast.warn({\n        title: 'Async error!',\n        message:\n          'data' in action.error\n            ? (action.error.data as { message: string }).message\n            : action.error.message,\n      })\n    }\n\n    return next(action)\n  }\n"})})]})}function u(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>s});var t=n(6540);const o={},a=t.createContext(o);function i(e){const r=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(a.Provider,{value:r},e.children)}}}]);