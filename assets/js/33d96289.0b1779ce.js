"use strict";(self.webpackChunkredux_toolkit_zh=self.webpackChunkredux_toolkit_zh||[]).push([[9469],{9056:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var r=n(4848),o=n(8453);const i={id:"rtk-query",title:"RTK Query",sidebar_label:"RTK Query Quick Start",hide_title:!0},s="RTK Query Quick Start",a={id:"tutorials/rtk-query",title:"RTK Query",description:"&nbsp;",source:"@site/docs/tutorials/rtk-query.mdx",sourceDirName:"tutorials",slug:"/tutorials/rtk-query",permalink:"/tutorials/rtk-query",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/rtk-query.mdx",tags:[],version:"current",frontMatter:{id:"rtk-query",title:"RTK Query",sidebar_label:"RTK Query Quick Start",hide_title:!0},sidebar:"docs",previous:{title:"TypeScript Quick Start",permalink:"/tutorials/typescript"},next:{title:"Migrating to Modern Redux",permalink:"/usage/migrating-to-modern-redux"}},d={},c=[{value:"Introduction",id:"introduction",level:2},{value:"How to Read This Tutorial",id:"how-to-read-this-tutorial",level:3},{value:"Setting up your store and API service",id:"setting-up-your-store-and-api-service",level:2},{value:"Create an API service",id:"create-an-api-service",level:3},{value:"Add the service to your store",id:"add-the-service-to-your-store",level:3},{value:"Wrap your application with the <code>Provider</code>",id:"wrap-your-application-with-the-provider",level:3},{value:"Use the query in a component",id:"use-the-query-in-a-component",level:2},{value:"Basic Example",id:"basic-example",level:4},{value:"Advanced example",id:"advanced-example",level:4}];function l(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"\xa0"}),"\n",(0,r.jsx)(t.h1,{id:"rtk-query-quick-start",children:"RTK Query Quick Start"}),"\n",(0,r.jsx)(t.admonition,{title:"What You'll Learn",type:"tip",children:(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:'How to set up and use Redux Toolkit\'s "RTK Query" data fetching functionality'}),"\n"]})}),"\n",(0,r.jsx)(t.admonition,{title:"Prerequisites",type:"info",children:(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Understanding of ",(0,r.jsx)(t.a,{href:"https://redux.js.org/tutorials/fundamentals/part-2-concepts-data-flow",children:"Redux terms and concepts"})]}),"\n"]})}),"\n",(0,r.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsxs)(t.p,{children:["Welcome to the Redux Toolkit Query tutorial! ",(0,r.jsx)(t.strong,{children:'This tutorial will briefly introduce you to Redux Toolkit\'s "RTK Query" data fetching capability and teach you how to start using it correctly'}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsxs)(t.p,{children:["For a more in-depth tutorial on RTK Query, see the full ",(0,r.jsx)(t.a,{href:"https://redux.js.org/tutorials/essentials/part-7-rtk-query-basics",children:'"Redux Essentials" tutorial'})," on the Redux core docs site."]})}),"\n",(0,r.jsxs)(t.p,{children:["RTK Query is an advanced data fetching and caching tool, designed to simplify common cases for loading data in a web application. RTK Query itself is built on top of the Redux Toolkit core, and leverages RTK's APIs like ",(0,r.jsx)(t.a,{href:"/api/createSlice",children:(0,r.jsx)(t.code,{children:"createSlice"})})," and ",(0,r.jsx)(t.a,{href:"/api/createAsyncThunk",children:(0,r.jsx)(t.code,{children:"createAsyncThunk"})})," to implement its capabilities."]}),"\n",(0,r.jsxs)(t.p,{children:["RTK Query is included in the ",(0,r.jsx)(t.code,{children:"@reduxjs/toolkit"})," package as an additional addon. You are not required to use the RTK Query APIs when you use Redux Toolkit, but we think many users will benefit from RTK Query's data fetching and caching in their apps."]}),"\n",(0,r.jsx)(t.h3,{id:"how-to-read-this-tutorial",children:"How to Read This Tutorial"}),"\n",(0,r.jsxs)(t.p,{children:["For this tutorial, we assume that you're using Redux Toolkit with React, but you can also use it with other UI layers as well. The examples are based on ",(0,r.jsx)(t.a,{href:"https://create-react-app.dev/docs/folder-structure",children:"a typical Create-React-App folder structure"})," where all the application code is in a ",(0,r.jsx)(t.code,{children:"src"}),", but the patterns can be adapted to whatever project or folder setup you're using."]}),"\n",(0,r.jsx)(t.h2,{id:"setting-up-your-store-and-api-service",children:"Setting up your store and API service"}),"\n",(0,r.jsx)(t.p,{children:"To see how RTK Query works, let's walk through a basic usage example. For this example, we'll assume you're using React and want to make use of RTK Query's auto-generated React hooks."}),"\n",(0,r.jsx)(t.h3,{id:"create-an-api-service",children:"Create an API service"}),"\n",(0,r.jsxs)(t.p,{children:["First, we'll create a service definition that queries the publicly available ",(0,r.jsx)(t.a,{href:"https://pokeapi.co/",children:"PokeAPI"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",metastring:'title="src/services/pokemon.ts"',children:"// file: services/types.ts noEmit\nexport type Pokemon = {}\n\n// file: services/pokemon.ts\n// Need to use the React-specific entry point to import createApi\nimport { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\nimport type { Pokemon } from './types'\n\n// highlight-start\n// Define a service using a base URL and expected endpoints\nexport const pokemonApi = createApi({\n  reducerPath: 'pokemonApi',\n  baseQuery: fetchBaseQuery({ baseUrl: 'https://pokeapi.co/api/v2/' }),\n  endpoints: (builder) => ({\n    getPokemonByName: builder.query<Pokemon, string>({\n      query: (name) => `pokemon/${name}`,\n    }),\n  }),\n})\n//highlight-end\n\n// highlight-start\n// Export hooks for usage in functional components, which are\n// auto-generated based on the defined endpoints\nexport const { useGetPokemonByNameQuery } = pokemonApi\n// highlight-end\n"})}),"\n",(0,r.jsxs)(t.p,{children:["With RTK Query, you usually define your entire API definition in one place. This is most likely different from what you see with other libraries such as ",(0,r.jsx)(t.code,{children:"swr"})," or ",(0,r.jsx)(t.code,{children:"react-query"}),", and there are several reasons for that. Our perspective is that it's ",(0,r.jsx)(t.em,{children:"much"})," easier to keep track of how requests, cache invalidation, and general app configuration behave when they're all in one central location in comparison to having X number of custom hooks in different files throughout your application."]}),"\n",(0,r.jsxs)(t.admonition,{type:"tip",children:[(0,r.jsxs)(t.p,{children:["Typically, you should only have one API slice per base URL that your application needs to communicate with. For example, if your site fetches data from both ",(0,r.jsx)(t.code,{children:"/api/posts"})," and ",(0,r.jsx)(t.code,{children:"/api/users"}),", you would have a single API slice with ",(0,r.jsx)(t.code,{children:"/api/"})," as the base URL, and separate endpoint definitions for ",(0,r.jsx)(t.code,{children:"posts"})," and ",(0,r.jsx)(t.code,{children:"users"}),". This allows you to effectively take advantage of ",(0,r.jsx)(t.a,{href:"/rtk-query/usage/automated-refetching",children:"automated re-fetching"})," by defining ",(0,r.jsx)(t.a,{href:"/rtk-query/usage/automated-refetching#tags",children:"tag"})," relationships across endpoints."]}),(0,r.jsxs)(t.p,{children:["For maintainability purposes, you may wish to split up endpoint definitions across multiple files, while still maintaining a single API slice which includes all of these endpoints. See ",(0,r.jsx)(t.a,{href:"/rtk-query/usage/code-splitting",children:"code splitting"})," for how you can use the ",(0,r.jsx)(t.code,{children:"injectEndpoints"})," property to inject API endpoints from other files into a single API slice definition."]})]}),"\n",(0,r.jsx)(t.h3,{id:"add-the-service-to-your-store",children:"Add the service to your store"}),"\n",(0,r.jsx)(t.p,{children:'An RTKQ service generates a "slice reducer" that should be included in the Redux root reducer, and a custom middleware that handles the data fetching. Both need to be added to the Redux store.'}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",metastring:'title="src/store.ts"',children:"// file: services/pokemon.ts noEmit\nimport { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\n\nexport const pokemonApi = createApi({\n  reducerPath: 'pokemonApi',\n  baseQuery: fetchBaseQuery({ baseUrl: 'https://pokeapi.co/api/v2/' }),\n  endpoints: (builder) => ({\n    getPokemonByName: builder.query({\n      query: (name: string) => `pokemon/${name}`,\n    }),\n  }),\n})\n\n// file: store.ts\nimport { configureStore } from '@reduxjs/toolkit'\n// Or from '@reduxjs/toolkit/query/react'\nimport { setupListeners } from '@reduxjs/toolkit/query'\nimport { pokemonApi } from './services/pokemon'\n\nexport const store = configureStore({\n  reducer: {\n    // highlight-start\n    // Add the generated reducer as a specific top-level slice\n    [pokemonApi.reducerPath]: pokemonApi.reducer,\n    // highlight-end\n  },\n  // highlight-start\n  // Adding the api middleware enables caching, invalidation, polling,\n  // and other useful features of `rtk-query`.\n  middleware: (getDefaultMiddleware) =>\n    getDefaultMiddleware().concat(pokemonApi.middleware),\n  // highlight-end\n})\n\n// optional, but required for refetchOnFocus/refetchOnReconnect behaviors\n// see `setupListeners` docs - takes an optional callback as the 2nd arg for customization\nsetupListeners(store.dispatch)\n"})}),"\n",(0,r.jsxs)(t.h3,{id:"wrap-your-application-with-the-provider",children:["Wrap your application with the ",(0,r.jsx)(t.code,{children:"Provider"})]}),"\n",(0,r.jsx)(t.p,{children:"If you haven't already done so, follow the standard pattern for providing the Redux store to the rest of your React application component tree:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",metastring:'title="src/index.tsx"',children:"// file: App.tsx noEmit\nimport React from 'react'\nexport default function App() {\n  return <div>...</div>\n}\n\n// file: store.ts noEmit\nimport { configureStore } from '@reduxjs/toolkit'\n\nexport const store = configureStore({\n  reducer: {},\n})\n\n// file: index.tsx\nimport * as React from 'react'\nimport { render } from 'react-dom'\nimport { Provider } from 'react-redux'\n\nimport App from './App'\nimport { store } from './store'\n\nconst rootElement = document.getElementById('root')\nrender(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  rootElement\n)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"use-the-query-in-a-component",children:"Use the query in a component"}),"\n",(0,r.jsx)(t.p,{children:"Once a service has been defined, you can import the hooks to make a request."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",metastring:'title="src/App.tsx"',children:"// file: services/pokemon.ts noEmit\nimport { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\n\nexport const pokemonApi = createApi({\n  reducerPath: 'pokemonApi',\n  baseQuery: fetchBaseQuery({ baseUrl: 'https://pokeapi.co/api/v2/' }),\n  endpoints: (builder) => ({\n    getPokemonByName: builder.query({\n      query: (name: string) => `pokemon/${name}`,\n    }),\n  }),\n})\n\nexport const { useGetPokemonByNameQuery } = pokemonApi\n\n// file: App.tsx\nimport * as React from 'react'\n// highlight-next-line\nimport { useGetPokemonByNameQuery } from './services/pokemon'\n\nexport default function App() {\n  // highlight-start\n  // Using a query hook automatically fetches data and returns query values\n  const { data, error, isLoading } = useGetPokemonByNameQuery('bulbasaur')\n  // Individual hooks are also accessible under the generated endpoints:\n  // const { data, error, isLoading } = pokemonApi.endpoints.getPokemonByName.useQuery('bulbasaur')\n  // highlight-end\n\n  return (\n    <div className=\"App\">\n      {error ? (\n        <>Oh no, there was an error</>\n      ) : isLoading ? (\n        <>Loading...</>\n      ) : data ? (\n        <>\n          <h3>{data.species.name}</h3>\n          <img src={data.sprites.front_shiny} alt={data.species.name} />\n        </>\n      ) : null}\n    </div>\n  )\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["When making a request, you're able to track the state in several ways. You can always check ",(0,r.jsx)(t.code,{children:"data"}),", ",(0,r.jsx)(t.code,{children:"status"}),", and ",(0,r.jsx)(t.code,{children:"error"})," to determine the right UI to render. In addition, ",(0,r.jsx)(t.code,{children:"useQuery"})," also provides utility booleans like ",(0,r.jsx)(t.code,{children:"isLoading"}),", ",(0,r.jsx)(t.code,{children:"isFetching"}),", ",(0,r.jsx)(t.code,{children:"isSuccess"}),", and ",(0,r.jsx)(t.code,{children:"isError"})," for the latest request."]}),"\n",(0,r.jsx)(t.h4,{id:"basic-example",children:"Basic Example"}),"\n",(0,r.jsx)("iframe",{src:"https://codesandbox.io/embed/github/reduxjs/redux-toolkit/tree/master/examples/query/react/basic?fontsize=12&runonclick=1&hidenavigation=1&theme=dark",style:{width:"100%",height:"500px",border:0,borderRadius:"4px",overflow:"hidden"},title:"rtk-query-getting-started-basic",allow:"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"}),"\n",(0,r.jsx)(t.p,{children:"Okay, that's interesting... but what if you wanted to show multiple pokemon at the same time? What happens if multiple components load the same pokemon?"}),"\n",(0,r.jsx)(t.h4,{id:"advanced-example",children:"Advanced example"}),"\n",(0,r.jsxs)(t.p,{children:["RTK Query ensures that any component that subscribes to the same query will always use the same data. RTK Query automatically de-dupes requests so you don't have to worry about checking in-flight requests and performance optimizations on your end. Let's evaluate the sandbox below - make sure to check the Network panel in your browser's dev tools. You will see 3 requests, even though there are 4 subscribed components - ",(0,r.jsx)(t.code,{children:"bulbasaur"})," only makes one request, and the loading state is synchronized between the two components. For fun, try changing the value of the dropdown from ",(0,r.jsx)(t.code,{children:"Off"})," to ",(0,r.jsx)(t.code,{children:"1s"})," to see this behavior continue when a query is re-ran."]}),"\n",(0,r.jsx)("iframe",{src:"https://codesandbox.io/embed/github/reduxjs/redux-toolkit/tree/master/examples/query/react/advanced?file=/src/App.tsx?fontsize=12&runonclick=1&hidenavigation=1&theme=dark",style:{width:"100%",height:"600px",border:0,borderRadius:"4px",overflow:"hidden"},title:"rtk-query-getting-started-advanced",allow:"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"})]})}function u(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var r=n(6540);const o={},i=r.createContext(o);function s(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);