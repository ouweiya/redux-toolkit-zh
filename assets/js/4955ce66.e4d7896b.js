"use strict";(self.webpackChunkredux_toolkit_zh=self.webpackChunkredux_toolkit_zh||[]).push([[9500],{8819:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var t=r(4848),s=r(8453);const i={id:"usage-with-typescript",title:"\u4e0e TypeScript \u4e00\u8d77\u4f7f\u7528",sidebar_label:"\u4e0e TypeScript \u4e00\u8d77\u4f7f\u7528",hide_title:!0,description:"RTK Query > TypeScript: Instructions on how to use RTK Query with TypeScript"},o="\u4e0e TypeScript \u4e00\u8d77\u4f7f\u7528",d={id:"rtk-query/usage-with-typescript",title:"\u4e0e TypeScript \u4e00\u8d77\u4f7f\u7528",description:"RTK Query > TypeScript: Instructions on how to use RTK Query with TypeScript",source:"@site/docs/rtk-query/usage-with-typescript.mdx",sourceDirName:"rtk-query",slug:"/rtk-query/usage-with-typescript",permalink:"/redux-toolkit-zh/rtk-query/usage-with-typescript",draft:!1,unlisted:!1,editUrl:"https://github.com/ouweiya/redux-toolkit-zh/tree/master/docs/rtk-query/usage-with-typescript.mdx",tags:[],version:"current",frontMatter:{id:"usage-with-typescript",title:"\u4e0e TypeScript \u4e00\u8d77\u4f7f\u7528",sidebar_label:"\u4e0e TypeScript \u4e00\u8d77\u4f7f\u7528",hide_title:!0,description:"RTK Query > TypeScript: Instructions on how to use RTK Query with TypeScript"},sidebar:"docs",previous:{title:"RTK Query \u793a\u4f8b",permalink:"/redux-toolkit-zh/rtk-query/usage/examples"},next:{title:"\u67e5\u8be2",permalink:"/redux-toolkit-zh/rtk-query/usage/queries"}},a={},c=[{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",level:2},{value:"<code>createApi</code>",id:"createapi",level:2},{value:"\u4f7f\u7528\u81ea\u52a8\u751f\u6210\u7684 React \u94a9\u5b50",id:"\u4f7f\u7528\u81ea\u52a8\u751f\u6210\u7684-react-\u94a9\u5b50",level:3},{value:"\u5bf9 <code>baseQuery</code> \u8fdb\u884c\u7c7b\u578b\u5316",id:"\u5bf9-basequery-\u8fdb\u884c\u7c7b\u578b\u5316",level:3},{value:"\u4e3a\u67e5\u8be2\u548c\u53d8\u5f02 <code>endpoints</code> \u6dfb\u52a0\u7c7b\u578b",id:"\u4e3a\u67e5\u8be2\u548c\u53d8\u5f02-endpoints-\u6dfb\u52a0\u7c7b\u578b",level:3},{value:"\u4e3a <code>queryFn</code> \u6dfb\u52a0\u7c7b\u578b",id:"\u4e3a-queryfn-\u6dfb\u52a0\u7c7b\u578b",level:3},{value:"\u4e3a <code>dispatch</code> \u548c <code>getState</code> \u7c7b\u578b\u5316",id:"\u4e3a-dispatch-\u548c-getstate-\u7c7b\u578b\u5316",level:3},{value:"\u4e3a <code>providesTags</code>/<code>invalidatesTags</code> \u7c7b\u578b\u5316",id:"\u4e3a-providestagsinvalidatestags-\u7c7b\u578b\u5316",level:3},{value:"\u4f7f\u7528 <code>skipToken</code> \u5728 TypeScript \u4e2d\u8df3\u8fc7\u67e5\u8be2",id:"\u4f7f\u7528-skiptoken-\u5728-typescript-\u4e2d\u8df3\u8fc7\u67e5\u8be2",level:2},{value:"\u7c7b\u578b\u5b89\u5168\u7684\u9519\u8bef\u5904\u7406",id:"\u7c7b\u578b\u5b89\u5168\u7684\u9519\u8bef\u5904\u7406",level:2},{value:"\u9519\u8bef\u7ed3\u679c\u793a\u4f8b",id:"\u9519\u8bef\u7ed3\u679c\u793a\u4f8b",level:3},{value:"\u5185\u8054\u9519\u8bef\u5904\u7406\u793a\u4f8b",id:"\u5185\u8054\u9519\u8bef\u5904\u7406\u793a\u4f8b",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"\xa0"}),"\n",(0,t.jsx)(n.h1,{id:"\u4e0e-typescript-\u4e00\u8d77\u4f7f\u7528",children:"\u4e0e TypeScript \u4e00\u8d77\u4f7f\u7528"}),"\n",(0,t.jsx)(n.admonition,{title:"\u4f60\u5c06\u5b66\u5230\u4ec0\u4e48",type:"tip",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5982\u4f55\u4f7f\u7528\u5404\u79cd RTK Query APIs \u4e0e TypeScript"}),"\n"]})}),"\n",(0,t.jsx)(n.h2,{id:"\u7b80\u4ecb",children:"\u7b80\u4ecb"}),"\n",(0,t.jsx)(n.p,{children:"\u4e0e Redux Toolkit \u5305\u7684\u5176\u4f59\u90e8\u5206\u4e00\u6837\uff0cRTK Query \u662f\u7528 TypeScript \u7f16\u5199\u7684\uff0c\u5176 API \u65e8\u5728\u5728 TypeScript \u5e94\u7528\u7a0b\u5e8f\u4e2d\u65e0\u7f1d\u4f7f\u7528\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u6b64\u9875\u9762\u63d0\u4f9b\u4e86\u4f7f\u7528 RTK Query \u4e2d\u5305\u542b\u7684 APIs \u4e0e TypeScript \u4ee5\u53ca\u5982\u4f55\u6b63\u786e\u5730\u5bf9\u5b83\u4eec\u8fdb\u884c\u7c7b\u578b\u5316\u7684\u8be6\u7ec6\u4fe1\u606f\u3002"}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528 TypeScript 4.1+ \u4e0e RTK Query \u4ee5\u83b7\u5f97\u6700\u4f73\u7ed3\u679c\u3002"})}),(0,t.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u9047\u5230\u4efb\u4f55\u5728\u6b64\u9875\u9762\u4e0a\u672a\u63cf\u8ff0\u7684\u7c7b\u578b\u95ee\u9898\uff0c\u8bf7",(0,t.jsx)(n.a,{href:"https://github.com/reduxjs/redux-toolkit/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc",children:"\u5f00\u542f\u4e00\u4e2a\u95ee\u9898"}),"\u8fdb\u884c\u8ba8\u8bba\u3002"]})]}),"\n",(0,t.jsx)(n.h2,{id:"createapi",children:(0,t.jsx)(n.code,{children:"createApi"})}),"\n",(0,t.jsx)(n.h3,{id:"\u4f7f\u7528\u81ea\u52a8\u751f\u6210\u7684-react-\u94a9\u5b50",children:"\u4f7f\u7528\u81ea\u52a8\u751f\u6210\u7684 React \u94a9\u5b50"}),"\n",(0,t.jsxs)(n.p,{children:["RTK Query \u7684 React \u7279\u5b9a\u5165\u53e3\u70b9\u5bfc\u51fa\u4e86\u4e00\u4e2a\u7248\u672c\u7684 ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/createApi",children:(0,t.jsx)(n.code,{children:"createApi"})}),"\uff0c\u5b83\u4f1a\u81ea\u52a8\u4e3a\u5b9a\u4e49\u7684\u67e5\u8be2\u548c\u7a81\u53d8 ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/createApi#endpoints",children:(0,t.jsx)(n.code,{children:"endpoints"})})," \u751f\u6210 React \u94a9\u5b50\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u8981\u4f5c\u4e3a TypeScript \u7528\u6237\u4f7f\u7528\u81ea\u52a8\u751f\u6210\u7684 React \u94a9\u5b50\uff0c",(0,t.jsx)(n.strong,{children:"\u4f60\u9700\u8981\u4f7f\u7528 TS4.1+"}),"\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// \u6587\u4ef6: src/services/types.ts noEmit\nexport type Pokemon = {}\n\n// \u6587\u4ef6: src/services/pokemon.ts\n// \u9700\u8981\u4f7f\u7528 React \u7279\u5b9a\u7684\u5165\u53e3\u70b9\u4ee5\u5141\u8bb8\u751f\u6210 React \u94a9\u5b50\nimport { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\nimport type { Pokemon } from './types'\n\n// \u4f7f\u7528\u57fa\u7840 URL \u548c\u9884\u671f\u7684\u7aef\u70b9\u5b9a\u4e49\u670d\u52a1\nexport const pokemonApi = createApi({\n  reducerPath: 'pokemonApi',\n  baseQuery: fetchBaseQuery({ baseUrl: 'https://pokeapi.co/api/v2/' }),\n  endpoints: (builder) => ({\n    getPokemonByName: builder.query<Pokemon, string>({\n      query: (name) => `pokemon/${name}`,\n    }),\n  }),\n})\n\n// highlight-start\n// \u5bfc\u51fa\u7528\u4e8e\u5728\u51fd\u6570\u7ec4\u4ef6\u4e2d\u4f7f\u7528\u7684\u94a9\u5b50\uff0c\u8fd9\u4e9b\u94a9\u5b50\u662f\n// \u6839\u636e\u5b9a\u4e49\u7684\u7aef\u70b9\u81ea\u52a8\u751f\u6210\u7684\nexport const { useGetPokemonByNameQuery } = pokemonApi\n// highlight-end\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5bf9\u4e8e\u65e7\u7248\u672c\u7684 TS\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"api.endpoints.[endpointName].useQuery/useMutation"})," \u6765\u8bbf\u95ee\u76f8\u540c\u7684\u94a9\u5b50\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="\u76f4\u63a5\u8bbf\u95ee api \u94a9\u5b50"',children:"// \u6587\u4ef6: src/services/types.ts noEmit\nexport type Pokemon = {}\n\n// \u6587\u4ef6: src/services/pokemon.ts noEmit\nimport { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\nimport type { Pokemon } from './types'\n\nexport const pokemonApi = createApi({\n  reducerPath: 'pokemonApi',\n  baseQuery: fetchBaseQuery({ baseUrl: 'https://pokeapi.co/api/v2/' }),\n  endpoints: (builder) => ({\n    getPokemonByName: builder.query<Pokemon, string>({\n      query: (name) => `pokemon/${name}`,\n    }),\n  }),\n})\n\nexport const { useGetPokemonByNameQuery } = pokemonApi\n\n// \u6587\u4ef6: src/services/manual-query.ts\nimport { pokemonApi } from './pokemon'\n\nconst useGetPokemonByNameQuery = pokemonApi.endpoints.getPokemonByName.useQuery\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"\u5bf9-basequery-\u8fdb\u884c\u7c7b\u578b\u5316",children:["\u5bf9 ",(0,t.jsx)(n.code,{children:"baseQuery"})," \u8fdb\u884c\u7c7b\u578b\u5316"]}),"\n",(0,t.jsxs)(n.p,{children:["\u53ef\u4ee5\u4f7f\u7528 RTK Query \u5bfc\u51fa\u7684 ",(0,t.jsx)(n.code,{children:"BaseQueryFn"})," \u7c7b\u578b\u5bf9\u81ea\u5b9a\u4e49 ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/createApi#basequery",children:(0,t.jsx)(n.code,{children:"baseQuery"})})," \u8fdb\u884c\u7c7b\u578b\u5316\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="Base Query \u7b7e\u540d" no-transpile',children:"export type BaseQueryFn<\n  Args = any,\n  Result = unknown,\n  Error = unknown,\n  DefinitionExtraOptions = {},\n  Meta = {},\n> = (\n  args: Args,\n  api: BaseQueryApi,\n  extraOptions: DefinitionExtraOptions,\n) => MaybePromise<QueryReturnValue<Result, Error, Meta>>\n\nexport interface BaseQueryApi {\n  signal: AbortSignal\n  dispatch: ThunkDispatch<any, any, any>\n  getState: () => unknown\n}\n\nexport type QueryReturnValue<T = unknown, E = unknown, M = unknown> =\n  | {\n      error: E\n      data?: undefined\n      meta?: M\n    }\n  | {\n      error?: undefined\n      data: T\n      meta?: M\n    }\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"BaseQueryFn"})," \u7c7b\u578b\u63a5\u53d7\u4ee5\u4e0b\u6cdb\u578b\uff1a"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Args"})," - \u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\u3002\u7aef\u70b9\u4e0a\u7684 ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/createApi#query",children:(0,t.jsx)(n.code,{children:"query"})})," \u5c5e\u6027\u8fd4\u56de\u7684\u7ed3\u679c\u5c06\u5728\u6b64\u5904\u4f20\u9012\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Result"})," - \u6210\u529f\u60c5\u51b5\u4e0b ",(0,t.jsx)(n.code,{children:"data"})," \u5c5e\u6027\u8981\u8fd4\u56de\u7684\u7c7b\u578b\u3002\u9664\u975e\u4f60\u671f\u671b\u6240\u6709\u67e5\u8be2\u548c\u7a81\u53d8\u90fd\u8fd4\u56de\u76f8\u540c\u7684\u7c7b\u578b\uff0c\u5426\u5219\u5efa\u8bae\u5c06\u6b64\u7c7b\u578b\u4fdd\u6301\u4e3a ",(0,t.jsx)(n.code,{children:"unknown"}),"\uff0c\u5e76\u5982\u4e0b\u6240\u793a\u5355\u72ec\u6307\u5b9a\u7c7b\u578b\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Error"})," - \u9519\u8bef\u60c5\u51b5\u4e0b ",(0,t.jsx)(n.code,{children:"error"})," \u5c5e\u6027\u8981\u8fd4\u56de\u7684\u7c7b\u578b\u3002\u6b64\u7c7b\u578b\u4e5f\u9002\u7528\u4e8e API \u5b9a\u4e49\u4e2d\u6240\u6709\u7aef\u70b9\u4f7f\u7528\u7684 ",(0,t.jsx)(n.a,{href:"#typing-a-queryfn",children:(0,t.jsx)(n.code,{children:"queryFn"})})," \u51fd\u6570\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"DefinitionExtraOptions"})," - \u51fd\u6570\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\u3002\u5728\u7aef\u70b9\u4e0a\u63d0\u4f9b\u7ed9 ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/createApi#extraoptions",children:(0,t.jsx)(n.code,{children:"extraOptions"})})," \u5c5e\u6027\u7684\u503c\u5c06\u5728\u6b64\u5904\u4f20\u9012\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Meta"})," - \u53ef\u80fd\u4ece\u8c03\u7528 ",(0,t.jsx)(n.code,{children:"baseQuery"})," \u8fd4\u56de\u7684 ",(0,t.jsx)(n.code,{children:"meta"})," \u5c5e\u6027\u7684\u7c7b\u578b\u3002",(0,t.jsx)(n.code,{children:"meta"})," \u5c5e\u6027\u53ef\u4ee5\u4f5c\u4e3a ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/createApi#transformresponse",children:(0,t.jsx)(n.code,{children:"transformResponse"})})," \u548c ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/createApi#transformerrorresponse",children:(0,t.jsx)(n.code,{children:"transformErrorResponse"})})," \u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8bbf\u95ee\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["\u4ece ",(0,t.jsx)(n.code,{children:"baseQuery"})," \u8fd4\u56de\u7684 ",(0,t.jsx)(n.code,{children:"meta"})," \u5c5e\u6027\u603b\u662f\u88ab\u89c6\u4e3a\u53ef\u80fd\u672a\u5b9a\u4e49\u7684\uff0c\u56e0\u4e3a\u5728\u9519\u8bef\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5b83\u672a\u88ab\u63d0\u4f9b\u3002\u5728\u8bbf\u95ee ",(0,t.jsx)(n.code,{children:"meta"})," \u5c5e\u6027\u7684\u503c\u65f6\uff0c\u5e94\u8003\u8651\u5230\u8fd9\u4e00\u70b9\uff0c\u4f8b\u5982\u4f7f\u7528",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining",children:"\u53ef\u9009\u94fe"}),"\u3002"]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="\u7b80\u5355\u7684 baseQuery TypeScript \u793a\u4f8b"',children:"import { createApi } from '@reduxjs/toolkit/query'\nimport type { BaseQueryFn } from '@reduxjs/toolkit/query'\n\nconst simpleBaseQuery: BaseQueryFn<\n  string, // Args\n  unknown, // Result\n  { reason: string }, // Error\n  { shout?: boolean }, // DefinitionExtraOptions\n  { timestamp: number } // Meta\n> = (arg, api, extraOptions) => {\n  // `arg` \u7684\u7c7b\u578b\u4e3a `string`\n  // `api` \u7684\u7c7b\u578b\u4e3a `BaseQueryApi`\uff08\u4e0d\u53ef\u914d\u7f6e\uff09\n  // `extraOptions` \u7684\u7c7b\u578b\u4e3a `{ shout?: boolean }\n\n  const meta = { timestamp: Date.now() }\n\n  if (arg === 'forceFail') {\n    return {\n      error: {\n        reason: 'Intentionally requested to fail!',\n        meta,\n      },\n    }\n  }\n\n  if (extraOptions.shout) {\n    return { data: 'CONGRATULATIONS', meta }\n  }\n\n  return { data: 'congratulations', meta }\n}\n\nconst api = createApi({\n  baseQuery: simpleBaseQuery,\n  endpoints: (builder) => ({\n    getSupport: builder.query({\n      query: () => 'support me',\n      extraOptions: {\n        shout: true,\n      },\n    }),\n  }),\n})\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"\u4e3a\u67e5\u8be2\u548c\u53d8\u5f02-endpoints-\u6dfb\u52a0\u7c7b\u578b",children:["\u4e3a\u67e5\u8be2\u548c\u53d8\u5f02 ",(0,t.jsx)(n.code,{children:"endpoints"})," \u6dfb\u52a0\u7c7b\u578b"]}),"\n",(0,t.jsxs)(n.p,{children:["\u4f7f\u7528\u6784\u5efa\u5668\u8bed\u6cd5\uff0c",(0,t.jsx)(n.code,{children:"endpoints"})," \u88ab\u5b9a\u4e49\u4e3a\u4e00\u4e2a\u5bf9\u8c61\u3002\u901a\u8fc7\u5411 ",(0,t.jsx)(n.code,{children:"<ResultType, QueryArg>"})," \u683c\u5f0f\u7684\u6cdb\u578b\u63d0\u4f9b\u7c7b\u578b\uff0c\u53ef\u4ee5\u4e3a ",(0,t.jsx)(n.code,{children:"query"})," \u548c ",(0,t.jsx)(n.code,{children:"mutation"})," endpoints \u6dfb\u52a0\u7c7b\u578b\u3002"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ResultType"})," - \u67e5\u8be2\u8fd4\u56de\u7684\u6700\u7ec8\u6570\u636e\u7684\u7c7b\u578b\uff0c\u8003\u8651\u5230\u53ef\u9009\u7684 ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/createApi#transformresponse",children:(0,t.jsx)(n.code,{children:"transformResponse"})}),"\u3002","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5982\u679c\u6ca1\u6709\u63d0\u4f9b ",(0,t.jsx)(n.code,{children:"transformResponse"}),"\uff0c\u90a3\u4e48\u5c31\u4f1a\u88ab\u89c6\u4e3a\u6210\u529f\u7684\u67e5\u8be2\u5c06\u8fd4\u56de\u8fd9\u79cd\u7c7b\u578b\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:["\u5982\u679c\u63d0\u4f9b\u4e86 ",(0,t.jsx)(n.code,{children:"transformResponse"}),"\uff0c\u90a3\u4e48 ",(0,t.jsx)(n.code,{children:"transformResponse"})," \u7684\u8f93\u5165\u7c7b\u578b\u4e5f\u5fc5\u987b\u6307\u5b9a\uff0c\u4ee5\u6307\u793a\u521d\u59cb\u67e5\u8be2\u8fd4\u56de\u7684\u7c7b\u578b\u3002",(0,t.jsx)(n.code,{children:"transformResponse"})," \u7684\u8fd4\u56de\u7c7b\u578b\u5fc5\u987b\u4e0e ",(0,t.jsx)(n.code,{children:"ResultType"})," \u5339\u914d\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:["\u5982\u679c\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"queryFn"})," \u800c\u4e0d\u662f ",(0,t.jsx)(n.code,{children:"query"}),"\uff0c\u90a3\u4e48\u5b83\u5fc5\u987b\u8fd4\u56de\u4ee5\u4e0b\u5f62\u72b6\u7684\u6210\u529f\u6848\u4f8b\uff1a","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"no-transpile",children:"{\n  data: ResultType\n}\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"QueryArg"})," - \u5c06\u4f5c\u4e3a\u552f\u4e00\u53c2\u6570\u4f20\u9012\u7ed9 endpoint \u7684 ",(0,t.jsx)(n.code,{children:"query"})," \u5c5e\u6027\uff0c\u6216\u8005\u5982\u679c\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"queryFn"})," \u5c5e\u6027\uff0c\u5219\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5982\u679c ",(0,t.jsx)(n.code,{children:"query"})," \u6ca1\u6709\u53c2\u6570\uff0c\u90a3\u4e48\u5fc5\u987b\u660e\u786e\u63d0\u4f9b ",(0,t.jsx)(n.code,{children:"void"})," \u7c7b\u578b\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:["\u5982\u679c ",(0,t.jsx)(n.code,{children:"query"})," \u6709\u4e00\u4e2a\u53ef\u9009\u53c2\u6570\uff0c\u90a3\u4e48\u5fc5\u987b\u63d0\u4f9b\u53c2\u6570\u7c7b\u578b\u548c ",(0,t.jsx)(n.code,{children:"void"})," \u7684\u8054\u5408\u7c7b\u578b\uff0c\u4f8b\u5982 ",(0,t.jsx)(n.code,{children:"number | void"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="\u4f7f\u7528 TypeScript \u5b9a\u4e49 endpoints"',children:"import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\ninterface Post {\n  id: number\n  name: string\n}\n\nconst api = createApi({\n  baseQuery: fetchBaseQuery({ baseUrl: '/' }),\n  endpoints: (build) => ({\n    // highlight-start\n    //              ResultType  QueryArg\n    //                    v       v\n    getPost: build.query<Post, number>({\n      // \u4ece `QueryArg` \u7c7b\u578b\u63a8\u65ad\u51fa `number`\n      //       v\n      query: (id) => `post/${id}`,\n      // \u5f53\u4f7f\u7528 `transformResponse` \u65f6\uff0c\u5fc5\u987b\u4e3a\u67e5\u8be2\u8fd4\u56de\u7684\u539f\u59cb\u7ed3\u679c\u63d0\u4f9b\u660e\u786e\u7684\u7c7b\u578b\n      //                             v\n      transformResponse: (rawResult: { result: { post: Post } }, meta) => {\n        //                                                        ^\n        // \u57fa\u4e8e\u7528\u4e8e `baseQuery` \u7684\u7c7b\u578b\uff0c\u53ef\u9009\u7684 `meta` \u5c5e\u6027\u53ef\u7528\n\n        // `transformResponse` \u7684\u8fd4\u56de\u503c\u5fc5\u987b\u4e0e `ResultType` \u5339\u914d\n        return rawResult.result.post\n      },\n    }),\n    // highlight-end\n  }),\n})\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"queries"})," \u548c ",(0,t.jsx)(n.code,{children:"mutations"})," \u7684\u8fd4\u56de\u7c7b\u578b\u4e5f\u53ef\u4ee5\u7531 ",(0,t.jsx)(n.a,{href:"#typing-a-basequery",children:(0,t.jsx)(n.code,{children:"baseQuery"})})," \u5b9a\u4e49\uff0c\u800c\u4e0d\u662f\u4e0a\u9762\u663e\u793a\u7684\u65b9\u6cd5\uff0c\u4f46\u662f\uff0c\u9664\u975e\u4f60\u671f\u671b\u6240\u6709\u7684\u67e5\u8be2\u548c\u53d8\u5f02\u90fd\u8fd4\u56de\u76f8\u540c\u7684\u7c7b\u578b\uff0c\u5426\u5219\u5efa\u8bae\u5c06 ",(0,t.jsx)(n.code,{children:"baseQuery"})," \u7684\u8fd4\u56de\u7c7b\u578b\u4fdd\u7559\u4e3a ",(0,t.jsx)(n.code,{children:"unknown"}),"\u3002"]})}),"\n",(0,t.jsxs)(n.h3,{id:"\u4e3a-queryfn-\u6dfb\u52a0\u7c7b\u578b",children:["\u4e3a ",(0,t.jsx)(n.code,{children:"queryFn"})," \u6dfb\u52a0\u7c7b\u578b"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5982\u5728 ",(0,t.jsx)(n.a,{href:"#typing-query-and-mutation-endpoints",children:"\u4e3a\u67e5\u8be2\u548c\u53d8\u5f02 endpoints \u6dfb\u52a0\u7c7b\u578b"})," \u4e2d\u63d0\u5230\u7684\uff0c",(0,t.jsx)(n.code,{children:"queryFn"})," \u5c06\u4ece\u63d0\u4f9b\u7ed9\u76f8\u5e94\u6784\u5efa endpoint \u7684\u6cdb\u578b\u4e2d\u63a5\u6536\u5176\u7ed3\u679c\u548c\u53c2\u6570\u7c7b\u578b\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// \u6587\u4ef6: randomData.ts noEmit\nexport declare const getRandomName: () => string\n\n// \u6587\u4ef6: api.ts\nimport { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\nimport { getRandomName } from './randomData'\n\ninterface Post {\n  id: number\n  name: string\n}\n\nconst api = createApi({\n  baseQuery: fetchBaseQuery({ baseUrl: '/' }),\n  endpoints: (build) => ({\n    // highlight-start\n    //              ResultType  QueryArg\n    //                    v       v\n    getPost: build.query<Post, number>({\n      // \u4ece `QueryArg` \u7c7b\u578b\u63a8\u65ad\u51fa `number`\n      //         v\n      queryFn: (arg, queryApi, extraOptions, baseQuery) => {\n        const post: Post = {\n          id: arg,\n          name: getRandomName(),\n        }\n        // \u5bf9\u4e8e\u6210\u529f\u7684\u60c5\u51b5\uff0c`data` \u5c5e\u6027\u7684\u8fd4\u56de\u7c7b\u578b\n        // \u5fc5\u987b\u4e0e `ResultType` \u5339\u914d\n        //              v\n        return { data: post }\n      },\n    }),\n    // highlight-end\n  }),\n})\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"queryFn"})," \u5fc5\u987b\u8fd4\u56de\u7684\u9519\u8bef\u7c7b\u578b\u7531\u63d0\u4f9b\u7ed9 ",(0,t.jsx)(n.code,{children:"createApi"})," \u7684 ",(0,t.jsx)(n.a,{href:"#typing-a-basequery",children:(0,t.jsx)(n.code,{children:"baseQuery"})})," \u786e\u5b9a\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5bf9\u4e8e ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/fetchBaseQuery",children:(0,t.jsx)(n.code,{children:"fetchBaseQuery"})}),"\uff0c\u9519\u8bef\u7c7b\u578b\u5982\u4e0b\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="fetchBaseQuery \u9519\u8bef\u5f62\u72b6" no-transpile',children:"{\n  status: number\n  data: any\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5bf9\u4e8e\u4e0a\u9762\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"queryFn"})," \u548c\u6765\u81ea ",(0,t.jsx)(n.code,{children:"fetchBaseQuery"})," \u7684\u9519\u8bef\u7c7b\u578b\u7684\u4f8b\u5b50\uff0c\u9519\u8bef\u60c5\u51b5\u53ef\u80fd\u5982\u4e0b\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="queryFn \u9519\u8bef\u793a\u4f8b\uff0c\u9519\u8bef\u7c7b\u578b\u6765\u81ea fetchBaseQuery"',children:"// \u6587\u4ef6: randomData.ts noEmit\nexport declare const getRandomName: () => string\n\n// \u6587\u4ef6: api.ts\nimport { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\nimport { getRandomName } from './randomData'\n\ninterface Post {\n  id: number\n  name: string\n}\n\nconst api = createApi({\n  baseQuery: fetchBaseQuery({ baseUrl: '/' }),\n  endpoints: (build) => ({\n    // highlight-start\n    getPost: build.query<Post, number>({\n      queryFn: (arg, queryApi, extraOptions, baseQuery) => {\n        // highlight-start\n        if (arg <= 0) {\n          return {\n            error: {\n              status: 500,\n              statusText: 'Internal Server Error',\n              data: 'Invalid ID provided.',\n            },\n          }\n        }\n        // highlight-end\n        const post: Post = {\n          id: arg,\n          name: getRandomName(),\n        }\n        return { data: post }\n      },\n    }),\n  }),\n})\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5bf9\u4e8e\u5e0c\u671b ",(0,t.jsx)(n.em,{children:"\u53ea"})," \u4e3a\u6bcf\u4e2a endpoint \u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"queryFn"})," \u5e76\u4e14\u5b8c\u5168\u4e0d\u5305\u542b ",(0,t.jsx)(n.code,{children:"baseQuery"})," \u7684\u7528\u6237\uff0cRTK Query \u63d0\u4f9b\u4e86\u4e00\u4e2a ",(0,t.jsx)(n.code,{children:"fakeBaseQuery"})," \u51fd\u6570\uff0c\u53ef\u4ee5\u7528\u6765\u8f7b\u677e\u6307\u5b9a\u6bcf\u4e2a ",(0,t.jsx)(n.code,{children:"queryFn"})," \u5e94\u8fd4\u56de\u7684\u9519\u8bef\u7c7b\u578b\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="\u6392\u9664\u6240\u6709 endpoints \u7684 baseQuery"',children:"import { createApi, fakeBaseQuery } from '@reduxjs/toolkit/query'\n\n// highlight-start\ntype CustomErrorType = { reason: 'too cold' | 'too hot' }\n// highlight-end\n\nconst api = createApi({\n  // highlight-start\n  // \u8fd9\u79cd\u7c7b\u578b\u5c06\u88ab\u7528\u4f5c\u6240\u6709 `queryFn` \u51fd\u6570\u63d0\u4f9b\u7684\u9519\u8bef\u7c7b\u578b\n  //                              v\n  baseQuery: fakeBaseQuery<CustomErrorType>(),\n  // highlight-end\n  endpoints: (build) => ({\n    eatPorridge: build.query<'just right', 1 | 2 | 3>({\n      // highlight-start\n      queryFn(seat) {\n        if (seat === 1) {\n          return { error: { reason: 'too cold' } }\n        }\n\n        if (seat === 2) {\n          return { error: { reason: 'too hot' } }\n        }\n\n        return { data: 'just right' }\n      },\n      // highlight-end\n    }),\n    microwaveHotPocket: build.query<'delicious!', number>({\n      // highlight-start\n      queryFn(duration) {\n        if (duration < 110) {\n          return { error: { reason: 'too cold' } }\n        }\n        if (duration > 140) {\n          return { error: { reason: 'too hot' } }\n        }\n\n        return { data: 'delicious!' }\n      },\n      // highlight-end\n    }),\n  }),\n})\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"\u4e3a-dispatch-\u548c-getstate-\u7c7b\u578b\u5316",children:["\u4e3a ",(0,t.jsx)(n.code,{children:"dispatch"})," \u548c ",(0,t.jsx)(n.code,{children:"getState"})," \u7c7b\u578b\u5316"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"createApi"})," \u5728\u591a\u4e2a\u5730\u65b9\u66b4\u9732\u4e86\u6807\u51c6\u7684 Redux ",(0,t.jsx)(n.code,{children:"dispatch"})," \u548c ",(0,t.jsx)(n.code,{children:"getState"})," \u65b9\u6cd5\uff0c\u4f8b\u5982\u5728\u751f\u547d\u5468\u671f\u65b9\u6cd5\u4e2d\u7684 ",(0,t.jsx)(n.code,{children:"lifecycleApi"})," \u53c2\u6570\uff0c\u6216\u8005\u4f20\u9012\u7ed9 ",(0,t.jsx)(n.code,{children:"queryFn"})," \u65b9\u6cd5\u548c\u57fa\u7840\u67e5\u8be2\u51fd\u6570\u7684 ",(0,t.jsx)(n.code,{children:"baseQueryApi"})," \u53c2\u6570\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u901a\u5e38\uff0c",(0,t.jsxs)(n.a,{href:"/redux-toolkit-zh/tutorials/typescript#define-root-state-and-dispatch-types",children:["\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u4f1a\u4ece\u5b58\u50a8\u8bbe\u7f6e\u4e2d\u63a8\u65ad\u51fa ",(0,t.jsx)(n.code,{children:"RootState"})," \u548c ",(0,t.jsx)(n.code,{children:"AppDispatch"})," \u7c7b\u578b"]}),"\u3002\u7531\u4e8e ",(0,t.jsx)(n.code,{children:"createApi"})," \u5fc5\u987b\u5728\u521b\u5efa Redux \u5b58\u50a8\u4e4b\u524d\u88ab\u8c03\u7528\uff0c\u5e76\u4e14\u88ab\u7528\u4f5c\u5b58\u50a8\u8bbe\u7f6e\u5e8f\u5217\u7684\u4e00\u90e8\u5206\uff0c\u56e0\u6b64\u5b83\u4e0d\u80fd\u76f4\u63a5\u77e5\u9053\u6216\u4f7f\u7528\u8fd9\u4e9b\u7c7b\u578b - \u8fd9\u5c06\u5bfc\u81f4\u5faa\u73af\u7c7b\u578b\u63a8\u65ad\u9519\u8bef\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c",(0,t.jsx)(n.code,{children:"createApi"})," \u5185\u90e8\u7684 ",(0,t.jsx)(n.code,{children:"dispatch"})," \u4f7f\u7528\u5c06\u88ab\u7c7b\u578b\u5316\u4e3a ",(0,t.jsx)(n.code,{children:"ThunkDispatch"}),"\uff0c",(0,t.jsx)(n.code,{children:"getState"})," \u7684\u4f7f\u7528\u88ab\u7c7b\u578b\u5316\u4e3a ",(0,t.jsx)(n.code,{children:"() => unknown"}),"\u3002\u4f60\u9700\u8981\u5728\u9700\u8981\u7684\u65f6\u5019\u65ad\u8a00\u7c7b\u578b - ",(0,t.jsx)(n.code,{children:"getState() as RootState"}),"\u3002\u4f60\u4e5f\u53ef\u4ee5\u4e3a\u51fd\u6570\u5305\u542b\u4e00\u4e2a\u660e\u786e\u7684\u8fd4\u56de\u7c7b\u578b\uff0c\u4ee5\u6253\u7834\u5faa\u73af\u7c7b\u578b\u63a8\u65ad\u5468\u671f\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"no-transpile",children:"const api = createApi({\n  baseQuery,\n  endpoints: (build) => ({\n    getTodos: build.query<Todo[], void>({\n      async queryFn() {\n        // highlight-start\n        // \u5c06\u72b6\u6001\u8f6c\u6362\u4e3a `RootState`\n        const state = getState() as RootState\n        // highlight-end\n        const text = state.todoTexts[queryFnCalls]\n        return { data: [{ id: `${queryFnCalls++}`, text }] }\n      },\n    }),\n  }),\n})\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"\u4e3a-providestagsinvalidatestags-\u7c7b\u578b\u5316",children:["\u4e3a ",(0,t.jsx)(n.code,{children:"providesTags"}),"/",(0,t.jsx)(n.code,{children:"invalidatesTags"})," \u7c7b\u578b\u5316"]}),"\n",(0,t.jsxs)(n.p,{children:["RTK Query \u4f7f\u7528\u7f13\u5b58\u6807\u7b7e\u5931\u6548\u7cfb\u7edf\uff0c\u4ee5\u63d0\u4f9b",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/usage/automated-refetching",children:"\u81ea\u52a8\u91cd\u65b0\u83b7\u53d6"}),"\u8fc7\u671f\u6570\u636e\u7684\u529f\u80fd\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5f53\u4f7f\u7528\u51fd\u6570\u8868\u793a\u6cd5\u65f6\uff0c\u7aef\u70b9\u4e0a\u7684 ",(0,t.jsx)(n.code,{children:"providesTags"})," \u548c ",(0,t.jsx)(n.code,{children:"invalidatesTags"})," \u5c5e\u6027\u90fd\u4f1a\u88ab\u4ee5\u4e0b\u53c2\u6570\u8c03\u7528\uff1a"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["result: ",(0,t.jsx)(n.code,{children:"ResultType"})," | ",(0,t.jsx)(n.code,{children:"undefined"})," - \u6210\u529f\u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u3002\u7c7b\u578b\u4e0e",(0,t.jsxs)(n.a,{href:"#typing-query-and-mutation-endpoints",children:["\u63d0\u4f9b\u7ed9\u6784\u5efa\u7aef\u70b9\u7684 ",(0,t.jsx)(n.code,{children:"ResultType"})," \u5bf9\u5e94"]}),"\u3002\u5bf9\u4e8e\u67e5\u8be2\u7684\u9519\u8bef\u60c5\u51b5\uff0c\u8fd9\u5c06\u662f ",(0,t.jsx)(n.code,{children:"undefined"}),"\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:["error: ",(0,t.jsx)(n.code,{children:"ErrorType"})," | ",(0,t.jsx)(n.code,{children:"undefined"})," - \u9519\u8bef\u67e5\u8be2\u8fd4\u56de\u7684\u9519\u8bef\u3002\u7c7b\u578b\u4e0e",(0,t.jsxs)(n.a,{href:"#typing-a-basequery",children:["\u63d0\u4f9b\u7ed9 api \u7684 ",(0,t.jsx)(n.code,{children:"baseQuery"})," \u7684 ",(0,t.jsx)(n.code,{children:"Error"})," \u5bf9\u5e94"]}),"\u3002\u5bf9\u4e8e\u67e5\u8be2\u7684\u6210\u529f\u60c5\u51b5\uff0c\u8fd9\u5c06\u662f ",(0,t.jsx)(n.code,{children:"undefined"}),"\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:["arg: ",(0,t.jsx)(n.code,{children:"QueryArg"})," - \u5f53\u67e5\u8be2\u672c\u8eab\u88ab\u8c03\u7528\u65f6\uff0c\u63d0\u4f9b\u7ed9 ",(0,t.jsx)(n.code,{children:"query"})," \u5c5e\u6027\u7684\u53c2\u6570\u3002\u7c7b\u578b\u4e0e",(0,t.jsxs)(n.a,{href:"#typing-query-and-mutation-endpoints",children:["\u63d0\u4f9b\u7ed9\u6784\u5efa\u7aef\u70b9\u7684 ",(0,t.jsx)(n.code,{children:"QueryArg"})," \u5bf9\u5e94"]}),"\u3002"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5f53\u67e5\u8be2\u8fd4\u56de\u4e00\u4e2a\u9879\u76ee\u5217\u8868\u65f6\uff0c\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"providesTags"})," \u7684\u63a8\u8350\u7528\u4f8b\u662f\u4e3a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u9879\u76ee\u63d0\u4f9b\u4e00\u4e2a\u6807\u7b7e\uff0c\u4f7f\u7528\u5b9e\u4f53 ID\uff0c\u4ee5\u53ca\u4e00\u4e2a 'LIST' ID \u6807\u7b7e\uff08\u53c2\u89c1",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/usage/automated-refetching#advanced-invalidation-with-abstract-tag-ids",children:"\u4f7f\u7528\u62bd\u8c61\u6807\u7b7e ID \u7684\u9ad8\u7ea7\u5931\u6548"}),"\uff09\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd9\u901a\u5e38\u901a\u8fc7\u5c06\u63a5\u6536\u5230\u7684\u6570\u636e\u6620\u5c04\u5230\u6570\u7ec4\u7684\u7ed3\u679c\u6269\u5c55\uff0c\u4ee5\u53ca\u6570\u7ec4\u4e2d\u7684\u989d\u5916\u9879\u7528\u4e8e ",(0,t.jsx)(n.code,{children:"'LIST'"})," ID \u6807\u7b7e\u6765\u7f16\u5199\u3002\u5f53\u6269\u5c55\u6620\u5c04\u6570\u7ec4\u65f6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cTypeScript \u5c06 ",(0,t.jsx)(n.code,{children:"type"})," \u5c5e\u6027\u6269\u5c55\u4e3a ",(0,t.jsx)(n.code,{children:"string"}),"\u3002\u7531\u4e8e\u6807\u7b7e ",(0,t.jsx)(n.code,{children:"type"})," \u5fc5\u987b\u5bf9\u5e94\u5230\u63d0\u4f9b\u7ed9 api \u7684 ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/createApi#tagtypes",children:(0,t.jsx)(n.code,{children:"tagTypes"})})," \u5c5e\u6027\u7684\u4e00\u4e2a\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\uff0c\u6240\u4ee5\u5e7f\u6cdb\u7684 ",(0,t.jsx)(n.code,{children:"string"})," \u7c7b\u578b\u5c06\u4e0d\u4f1a\u6ee1\u8db3 TypeScript\u3002\u4e3a\u4e86\u7f13\u89e3\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u5c06\u6807\u7b7e ",(0,t.jsx)(n.code,{children:"type"})," \u8f6c\u6362\u4e3a ",(0,t.jsx)(n.code,{children:"as const"}),"\uff0c\u4ee5\u9632\u6b62\u7c7b\u578b\u88ab\u6269\u5c55\u4e3a ",(0,t.jsx)(n.code,{children:"string"}),"\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="providesTags TypeScript \u793a\u4f8b"',children:"import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\ninterface Post {\n  id: number\n  name: string\n}\ntype PostsResponse = Post[]\n\nconst api = createApi({\n  baseQuery: fetchBaseQuery({ baseUrl: '/' }),\n  tagTypes: ['Posts'],\n  endpoints: (build) => ({\n    getPosts: build.query<PostsResponse, void>({\n      query: () => 'posts',\n      providesTags: (result) =>\n        result\n          ? [\n              // highlight-start\n              ...result.map(({ id }) => ({ type: 'Posts' as const, id })),\n              { type: 'Posts', id: 'LIST' },\n              // highlight-end\n            ]\n          : [{ type: 'Posts', id: 'LIST' }],\n    }),\n  }),\n})\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"\u4f7f\u7528-skiptoken-\u5728-typescript-\u4e2d\u8df3\u8fc7\u67e5\u8be2",children:["\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"skipToken"})," \u5728 TypeScript \u4e2d\u8df3\u8fc7\u67e5\u8be2"]}),"\n",(0,t.jsxs)(n.p,{children:["RTK Query \u63d0\u4f9b\u4e86\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"skip"})," \u53c2\u6570\u4f5c\u4e3a\u67e5\u8be2\u94a9\u5b50\u9009\u9879\u7684\u90e8\u5206\uff0c\u4ee5\u6709\u6761\u4ef6\u5730\u8df3\u8fc7\u81ea\u52a8\u8fd0\u884c\u7684\u67e5\u8be2\u7684\u80fd\u529b\uff08\u53c2\u89c1",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/usage/conditional-fetching",children:"\u6761\u4ef6\u83b7\u53d6"}),"\uff09\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["TypeScript \u7528\u6237\u53ef\u80fd\u4f1a\u53d1\u73b0\uff0c\u5f53\u67e5\u8be2\u53c2\u6570\u88ab\u7c7b\u578b\u5316\u4e3a\u4e0d\u662f ",(0,t.jsx)(n.code,{children:"undefined"}),"\uff0c\u5e76\u4e14\u4ed6\u4eec\u8bd5\u56fe\u5728\u53c2\u6570\u65e0\u6548\u65f6 ",(0,t.jsx)(n.code,{children:"skip"})," \u67e5\u8be2\u65f6\uff0c\u4ed6\u4eec\u4f1a\u9047\u5230\u65e0\u6548\u7684\u7c7b\u578b\u573a\u666f\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="API \u5b9a\u4e49"',children:"// \u6587\u4ef6: types.ts noEmit\nexport interface Post {\n  id: number\n  name: string\n}\n\n// \u6587\u4ef6: api.ts\nimport { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\nimport type { Post } from './types'\n\nexport const api = createApi({\n  baseQuery: fetchBaseQuery({ baseUrl: '/' }),\n  endpoints: (build) => ({\n    // \u67e5\u8be2\u53c2\u6570\u5fc5\u987b\u662f `number`\uff0c\u4e0d\u80fd\u662f `undefined`\n    //                            V\n    getPost: build.query<Post, number>({\n      query: (id) => `post/${id}`,\n    }),\n  }),\n})\n\nexport const { useGetPostQuery } = api\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:'no-transpile title="\u5728\u7ec4\u4ef6\u4e2d\u4f7f\u7528 skip"',children:"import { useGetPostQuery } from './api'\n\nfunction MaybePost({ id }: { id?: number }) {\n  // \u8fd9\u5c06\u4ea7\u751f\u4e00\u4e2a TypeScript \u9519\u8bef\uff1a\n  // \u7c7b\u578b 'number | undefined' \u7684\u53c2\u6570\u4e0d\u80fd\u8d4b\u503c\u7ed9\u7c7b\u578b 'number | unique symbol' \u7684\u53c2\u6570\u3002\n  // \u7c7b\u578b 'undefined' \u4e0d\u80fd\u8d4b\u503c\u7ed9\u7c7b\u578b 'number | unique symbol'\u3002\n\n  // @ts-expect-error \u4f20\u9012\u7684 id \u5fc5\u987b\u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u4f46\u662f\u6211\u4eec\u5728\u5b83\u4e0d\u662f\u6570\u5b57\u65f6\u4e0d\u8c03\u7528\u5b83\n  const { data } = useGetPostQuery(id, { skip: !id })\n\n  return <div>...</div>\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u867d\u7136\u4f60\u53ef\u80fd\u80fd\u591f\u8bf4\u670d\u81ea\u5df1\uff0c\u9664\u975e ",(0,t.jsx)(n.code,{children:"id"})," \u53c2\u6570\u5728\u90a3\u65f6\u662f\u4e00\u4e2a ",(0,t.jsx)(n.code,{children:"number"}),"\uff0c\u5426\u5219\u67e5\u8be2\u4e0d\u4f1a\u88ab\u8c03\u7528\uff0c\u4f46 TypeScript \u4e0d\u4f1a\u90a3\u4e48\u5bb9\u6613\u88ab\u8bf4\u670d\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["RTK Query \u63d0\u4f9b\u4e86\u4e00\u4e2a ",(0,t.jsx)(n.code,{children:"skipToken"})," \u5bfc\u51fa\uff0c\u5b83\u53ef\u4ee5\u4f5c\u4e3a\u8df3\u8fc7\u67e5\u8be2\u7684\u66ff\u4ee3\u65b9\u6cd5\uff0c\u540c\u65f6\u4fdd\u6301\u7c7b\u578b\u5b89\u5168\u3002\u5f53 ",(0,t.jsx)(n.code,{children:"skipToken"})," \u4f5c\u4e3a\u67e5\u8be2\u53c2\u6570\u4f20\u9012\u7ed9 ",(0,t.jsx)(n.code,{children:"useQuery"}),"\uff0c",(0,t.jsx)(n.code,{children:"useQueryState"})," \u6216 ",(0,t.jsx)(n.code,{children:"useQuerySubscription"})," \u65f6\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e0e\u5728\u67e5\u8be2\u9009\u9879\u4e2d\u8bbe\u7f6e ",(0,t.jsx)(n.code,{children:"skip: true"})," \u76f8\u540c\u7684\u6548\u679c\uff0c\u540c\u65f6\u5728 ",(0,t.jsx)(n.code,{children:"arg"})," \u53ef\u80fd\u5426\u5219\u672a\u5b9a\u4e49\u7684\u60c5\u51b5\u4e0b\u4e5f\u662f\u4e00\u4e2a\u6709\u6548\u7684\u53c2\u6570\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:'no-transpile title="\u5728\u7ec4\u4ef6\u4e2d\u4f7f\u7528 skipToken"',children:"import { skipToken } from '@reduxjs/toolkit/query/react'\nimport { useGetPostQuery } from './api'\n\nfunction MaybePost({ id }: { id?: number }) {\n  // \u5f53 `id` \u662f nullish\uff0c\u6211\u4eec\u4ecd\u7136\u4f1a\u8df3\u8fc7\u67e5\u8be2\u3002\n  // TypeScript \u4e5f\u5f88\u9ad8\u5174\u73b0\u5728\u67e5\u8be2\u53ea\u4f1a\u88ab\u4e00\u4e2a `number` \u8c03\u7528\n  const { data } = useGetPostQuery(id ?? skipToken)\n\n  return <div>...</div>\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u7c7b\u578b\u5b89\u5168\u7684\u9519\u8bef\u5904\u7406",children:"\u7c7b\u578b\u5b89\u5168\u7684\u9519\u8bef\u5904\u7406"}),"\n",(0,t.jsxs)(n.p,{children:["\u5f53\u4e00\u4e2a\u9519\u8bef\u4ece ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/createApi#baseQuery",children:(0,t.jsx)(n.code,{children:"base query"})})," \u4e2d\u4f18\u96c5\u5730\u63d0\u4f9b\u65f6\uff0cRTK \u67e5\u8be2\u5c06\u76f4\u63a5\u63d0\u4f9b\u9519\u8bef\u3002\u5982\u679c\u7528\u6237\u4ee3\u7801\u629b\u51fa\u4e86\u4e00\u4e2a\u610f\u5916\u7684\u9519\u8bef\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u5904\u7406\u8fc7\u7684\u9519\u8bef\uff0c\u90a3\u4e48\u8fd9\u4e2a\u9519\u8bef\u5c06\u88ab\u8f6c\u6362\u4e3a ",(0,t.jsx)(n.code,{children:"SerializedError"})," \u5f62\u72b6\u3002\u7528\u6237\u5e94\u786e\u4fdd\u5728\u5c1d\u8bd5\u8bbf\u95ee\u5176\u5c5e\u6027\u4e4b\u524d\uff0c\u68c0\u67e5\u4ed6\u4eec\u6b63\u5728\u5904\u7406\u54ea\u79cd\u7c7b\u578b\u7684\u9519\u8bef\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u7c7b\u578b\u4fdd\u62a4\uff0c\u4f8b\u5982\uff0c\u901a\u8fc7\u68c0\u67e5",(0,t.jsx)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/2/narrowing.html#the-in-operator-narrowing",children:"\u9274\u522b\u5c5e\u6027"}),"\uff0c\u6216\u8005\u4f7f\u7528",(0,t.jsx)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates",children:"\u7c7b\u578b\u8c13\u8bcd"}),"\u6765\u4ee5\u7c7b\u578b\u5b89\u5168\u7684\u65b9\u5f0f\u5b8c\u6210\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5f53\u4f7f\u7528 ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/rtk-query/api/fetchBaseQuery",children:(0,t.jsx)(n.code,{children:"fetchBaseQuery"})})," \u4f5c\u4e3a\u4f60\u7684\u57fa\u7840\u67e5\u8be2\u65f6\uff0c\u9519\u8bef\u5c06\u662f ",(0,t.jsx)(n.code,{children:"FetchBaseQueryError | SerializedError"})," \u7c7b\u578b\u3002\u8fd9\u4e9b\u7c7b\u578b\u7684\u5177\u4f53\u5f62\u72b6\u53ef\u4ee5\u5728\u4e0b\u9762\u770b\u5230\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="FetchBaseQueryError \u7c7b\u578b"',children:'export type FetchBaseQueryError =\n  | {\n      /**\n       * * `number`:\n       *   HTTP \u72b6\u6001\u7801\n       */\n      status: number\n      data: unknown\n    }\n  | {\n      /**\n       * * `"FETCH_ERROR"`:\n       *   \u5728\u6267\u884c `fetch` \u6216 `fetchFn` \u56de\u8c03\u9009\u9879\u671f\u95f4\u53d1\u751f\u7684\u9519\u8bef\n       **/\n      status: \'FETCH_ERROR\'\n      data?: undefined\n      error: string\n    }\n  | {\n      /**\n       * * `"PARSING_ERROR"`:\n       *   \u5728\u89e3\u6790\u8fc7\u7a0b\u4e2d\u53d1\u751f\u7684\u9519\u8bef\u3002\n       *   \u6700\u6709\u53ef\u80fd\u7684\u662f\u8fd4\u56de\u4e86\u4e00\u4e2a\u975e JSON \u54cd\u5e94\uff0c\u4f7f\u7528\u9ed8\u8ba4\u7684 `responseHandler` "JSON"\uff0c\n       *   \u6216\u8005\u5728\u6267\u884c\u81ea\u5b9a\u4e49 `responseHandler` \u65f6\u53d1\u751f\u4e86\u9519\u8bef\u3002\n       **/\n      status: \'PARSING_ERROR\'\n      originalStatus: number\n      data: string\n      error: string\n    }\n  | {\n      /**\n       * * `"CUSTOM_ERROR"`:\n       *   \u4f60\u53ef\u4ee5\u4ece\u4f60\u7684 `queryFn` \u8fd4\u56de\u7684\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b\uff0c\u5176\u4e2d\u5176\u4ed6\u9519\u8bef\u53ef\u80fd\u6ca1\u6709\u610f\u4e49\u3002\n       **/\n      status: \'CUSTOM_ERROR\'\n      data?: unknown\n      error: string\n    }\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="SerializedError \u7c7b\u578b"',children:"export interface SerializedError {\n  name?: string\n  message?: string\n  stack?: string\n  code?: string\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u9519\u8bef\u7ed3\u679c\u793a\u4f8b",children:"\u9519\u8bef\u7ed3\u679c\u793a\u4f8b"}),"\n",(0,t.jsxs)(n.p,{children:["\u5f53\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"fetchBaseQuery"})," \u65f6\uff0c\u4ece\u94a9\u5b50\u8fd4\u56de\u7684 ",(0,t.jsx)(n.code,{children:"error"})," \u5c5e\u6027\u5c06\u5177\u6709 ",(0,t.jsx)(n.code,{children:"FetchBaseQueryError | SerializedError | undefined"})," \u7c7b\u578b\u3002\u5982\u679c\u5b58\u5728\u9519\u8bef\uff0c\u4f60\u53ef\u4ee5\u5728\u5c06\u7c7b\u578b\u7f29\u5c0f\u5230 ",(0,t.jsx)(n.code,{children:"FetchBaseQueryError"})," \u6216 ",(0,t.jsx)(n.code,{children:"SerializedError"})," \u540e\u8bbf\u95ee\u9519\u8bef\u5c5e\u6027\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"no-transpile",children:"import { api } from './services/api'\n\nfunction PostDetail() {\n  const { data, error, isLoading } = usePostsQuery()\n\n  if (isLoading) {\n    return <div>\u52a0\u8f7d\u4e2d...</div>\n  }\n\n  if (error) {\n    if ('status' in error) {\n      // \u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u8bbf\u95ee `FetchBaseQueryError` \u7684\u6240\u6709\u5c5e\u6027\n      const errMsg = 'error' in error ? error.error : JSON.stringify(error.data)\n\n      return (\n        <div>\n          <div>\u53d1\u751f\u4e86\u4e00\u4e2a\u9519\u8bef\uff1a</div>\n          <div>{errMsg}</div>\n        </div>\n      )\n    } else {\n      // \u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u8bbf\u95ee `SerializedError` \u7684\u6240\u6709\u5c5e\u6027\n      return <div>{error.message}</div>\n    }\n  }\n\n  if (data) {\n    return (\n      <div>\n        {data.map((post) => (\n          <div key={post.id}>\u540d\u79f0: {post.name}</div>\n        ))}\n      </div>\n    )\n  }\n\n  return null\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u5185\u8054\u9519\u8bef\u5904\u7406\u793a\u4f8b",children:"\u5185\u8054\u9519\u8bef\u5904\u7406\u793a\u4f8b"}),"\n",(0,t.jsxs)(n.p,{children:["\u5f53\u5728 ",(0,t.jsx)(n.a,{href:"/redux-toolkit-zh/api/createAsyncThunk#unwrapping-result-actions",children:(0,t.jsx)(n.code,{children:"unwrapping"})})," \u4e00\u4e2a mutation \u8c03\u7528\u540e\u5185\u8054\u5904\u7406\u9519\u8bef\u65f6\uff0c\u629b\u51fa\u7684\u9519\u8bef\u5c06\u5bf9\u4e8e TypeScript \u7248\u672c\u4f4e\u4e8e 4.4 \u7684\u7c7b\u578b\u4e3a ",(0,t.jsx)(n.code,{children:"any"}),"\uff0c\u6216\u8005\u5bf9\u4e8e ",(0,t.jsxs)(n.a,{href:"https://devblogs.microsoft.com/typescript/announcing-typescript-4-4/#use-unknown-catch-variables",children:["4.4+ \u7248\u672c\u4e3a ",(0,t.jsx)(n.code,{children:"unknown"})]}),"\u3002\u4e3a\u4e86\u5b89\u5168\u5730\u8bbf\u95ee\u9519\u8bef\u7684\u5c5e\u6027\uff0c\u4f60\u5fc5\u987b\u9996\u5148\u5c06\u7c7b\u578b\u7f29\u5c0f\u5230\u5df2\u77e5\u7c7b\u578b\u3002\u8fd9\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u663e\u793a\u7684 ",(0,t.jsx)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates",children:"\u7c7b\u578b\u8c13\u8bcd"})," \u6765\u5b8c\u6210\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:'no-transpile title="services/helpers.ts"',children:"import { FetchBaseQueryError } from '@reduxjs/toolkit/query'\n\n/**\n * \u7c7b\u578b\u8c13\u8bcd\uff0c\u7528\u4e8e\u5c06\u672a\u77e5\u9519\u8bef\u7f29\u5c0f\u4e3a `FetchBaseQueryError`\n */\nexport function isFetchBaseQueryError(\n  error: unknown,\n): error is FetchBaseQueryError {\n  return typeof error === 'object' && error != null && 'status' in error\n}\n\n/**\n * \u7c7b\u578b\u8c13\u8bcd\uff0c\u7528\u4e8e\u5c06\u672a\u77e5\u9519\u8bef\u7f29\u5c0f\u4e3a\u5177\u6709\u5b57\u7b26\u4e32 'message' \u5c5e\u6027\u7684\u5bf9\u8c61\n */\nexport function isErrorWithMessage(\n  error: unknown,\n): error is { message: string } {\n  return (\n    typeof error === 'object' &&\n    error != null &&\n    'message' in error &&\n    typeof (error as any).message === 'string'\n  )\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:'no-transpile title="addPost.tsx"',children:"import { useState } from 'react'\nimport { useSnackbar } from 'notistack'\nimport { api } from './services/api'\nimport { isFetchBaseQueryError, isErrorWithMessage } from './services/helpers'\n\nfunction AddPost() {\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\n  const [name, setName] = useState('')\n  const [addPost] = useAddPostMutation()\n\n  async function handleAddPost() {\n    try {\n      await addPost(name).unwrap()\n      setName('')\n    } catch (err) {\n      if (isFetchBaseQueryError(err)) {\n        // \u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u8bbf\u95ee `FetchBaseQueryError` \u7684\u6240\u6709\u5c5e\u6027\n        const errMsg = 'error' in err ? err.error : JSON.stringify(err.data)\n        enqueueSnackbar(errMsg, { variant: 'error' })\n      } else if (isErrorWithMessage(err)) {\n        // \u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u8bbf\u95ee\u5b57\u7b26\u4e32 'message' \u5c5e\u6027\n        enqueueSnackbar(err.message, { variant: 'error' })\n      }\n    }\n  }\n\n  return (\n    <div>\n      <input value={name} onChange={(e) => setName(e.target.value)} />\n      <button>\u6dfb\u52a0\u5e16\u5b50</button>\n    </div>\n  )\n}\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>d});var t=r(6540);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);