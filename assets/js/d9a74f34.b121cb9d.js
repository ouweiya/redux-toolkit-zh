"use strict";(self.webpackChunkredux_toolkit_zh=self.webpackChunkredux_toolkit_zh||[]).push([[5405],{4736:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var i=t(4848),s=t(8453);const o={id:"setupListeners",title:"\u8bbe\u7f6e\u76d1\u542c\u5668",sidebar_label:"\u8bbe\u7f6e\u76d1\u542c\u5668",hide_title:!0,hide_table_of_contents:!1,description:"RTK Query > API: setupListeners reference"},r="setupListeners",c={id:"rtk-query/api/setupListeners",title:"\u8bbe\u7f6e\u76d1\u542c\u5668",description:"RTK Query > API: setupListeners reference",source:"@site/docs/rtk-query/api/setupListeners.mdx",sourceDirName:"rtk-query/api",slug:"/rtk-query/api/setupListeners",permalink:"/redux-toolkit-zh/rtk-query/api/setupListeners",draft:!1,unlisted:!1,editUrl:"https://github.com/ouweiya/redux-toolkit-zh/tree/master/docs/rtk-query/api/setupListeners.mdx",tags:[],version:"current",frontMatter:{id:"setupListeners",title:"\u8bbe\u7f6e\u76d1\u542c\u5668",sidebar_label:"\u8bbe\u7f6e\u76d1\u542c\u5668",hide_title:!0,hide_table_of_contents:!1,description:"RTK Query > API: setupListeners reference"},sidebar:"docs",previous:{title:"Api\u63d0\u4f9b\u8005",permalink:"/redux-toolkit-zh/rtk-query/api/ApiProvider"},next:{title:"API \u5207\u7247\u6982\u89c8",permalink:"/redux-toolkit-zh/rtk-query/api/created-api/overview"}},d={},l=[];function a(e){const n={code:"code",h1:"h1",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"\xa0"}),"\n",(0,i.jsx)(n.h1,{id:"setuplisteners",children:(0,i.jsx)(n.code,{children:"setupListeners"})}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u662f\u4e00\u4e2a\u7528\u4e8e\u542f\u7528 ",(0,i.jsx)(n.code,{children:"refetchOnFocus"})," \u548c ",(0,i.jsx)(n.code,{children:"refetchOnReconnect"})," \u884c\u4e3a\u7684\u5b9e\u7528\u5de5\u5177\u3002\u5b83\u9700\u8981\u4f60\u7684\u5b58\u50a8\u4e2d\u7684 ",(0,i.jsx)(n.code,{children:"dispatch"})," \u65b9\u6cd5\u3002\u8c03\u7528 ",(0,i.jsx)(n.code,{children:"setupListeners(store.dispatch)"})," \u5c06\u4f7f\u7528\u63a8\u8350\u7684\u9ed8\u8ba4\u503c\u914d\u7f6e\u76d1\u542c\u5668\uff0c\u4f46\u4f60\u4e5f\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\u4ee5\u8fdb\u884c\u66f4\u7cbe\u7ec6\u7684\u63a7\u5236\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="setupListeners \u9ed8\u8ba4\u914d\u7f6e" no-transpile',children:"let initialized = false\nexport function setupListeners(\n  dispatch: ThunkDispatch<any, any, any>,\n  customHandler?: (\n    dispatch: ThunkDispatch<any, any, any>,\n    actions: {\n      onFocus: typeof onFocus\n      onFocusLost: typeof onFocusLost\n      onOnline: typeof onOnline\n      onOffline: typeof onOffline\n    },\n  ) => () => void,\n) {\n  function defaultHandler() {\n    const handleFocus = () => dispatch(onFocus())\n    const handleFocusLost = () => dispatch(onFocusLost())\n    const handleOnline = () => dispatch(onOnline())\n    const handleOffline = () => dispatch(onOffline())\n    const handleVisibilityChange = () => {\n      if (window.document.visibilityState === 'visible') {\n        handleFocus()\n      } else {\n        handleFocusLost()\n      }\n    }\n\n    if (!initialized) {\n      if (typeof window !== 'undefined' && window.addEventListener) {\n        // \u5904\u7406\u7126\u70b9\u4e8b\u4ef6\n        window.addEventListener(\n          'visibilitychange',\n          handleVisibilityChange,\n          false,\n        )\n        window.addEventListener('focus', handleFocus, false)\n\n        // \u5904\u7406\u8fde\u63a5\u4e8b\u4ef6\n        window.addEventListener('online', handleOnline, false)\n        window.addEventListener('offline', handleOffline, false)\n        initialized = true\n      }\n    }\n    const unsubscribe = () => {\n      window.removeEventListener('focus', handleFocus)\n      window.removeEventListener('visibilitychange', handleVisibilityChange)\n      window.removeEventListener('online', handleOnline)\n      window.removeEventListener('offline', handleOffline)\n      initialized = false\n    }\n    return unsubscribe\n  }\n\n  return customHandler\n    ? customHandler(dispatch, { onFocus, onFocusLost, onOffline, onOnline })\n    : defaultHandler()\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u6ce8\u610f\u5230\uff0c",(0,i.jsx)(n.code,{children:"onFocus"}),"\uff0c",(0,i.jsx)(n.code,{children:"onFocusLost"}),"\uff0c",(0,i.jsx)(n.code,{children:"onOffline"}),"\uff0c",(0,i.jsx)(n.code,{children:"onOnline"})," \u90fd\u662f\u63d0\u4f9b\u7ed9\u56de\u8c03\u7684\u64cd\u4f5c\u3002\u6b64\u5916\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u53ef\u4ee5\u901a\u8fc7 ",(0,i.jsx)(n.code,{children:"api.internalActions"})," \u4f7f\u7528\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7\u50cf\u8fd9\u6837\u5206\u6d3e\u5b83\u4eec\u6765\u4f7f\u7528\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="\u624b\u52a8 onFocus \u4e8b\u4ef6" no-transpile',children:"dispatch(api.internalActions.onFocus())\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var i=t(6540);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);